<!doctypehtml><html prefix="og: http://ogp.me/ns#"lang=en_US><meta charset=utf-8><meta content=width=device-width,initial-scale=1 name=viewport><title>Recovering control flow structures without CFGs | purplesyringa's blog</title><link href=../../favicon.ico?v=2 rel=icon><link href=../../all.css rel=stylesheet><link href=../../blog.css rel=stylesheet><link href=../../vendor/Temml-Local.css rel=stylesheet><link crossorigin href=https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&family=Slabo+27px&display=swap rel=stylesheet><link href=../../fonts/webfont.css rel=stylesheet><link media="screen and (prefers-color-scheme: dark"href=../../vendor/atom-one-dark.min.css rel=stylesheet><link media="screen and (prefers-color-scheme: light"href=../../vendor/a11y-light.min.css rel=stylesheet><link title="Blog posts"href=../../blog/feed.rss rel=alternate type=application/rss+xml><meta content="Recovering control flow structures without CFGs"property=og:title><meta content=article property=og:type><meta content=https://purplesyringa.moe/blog/recovering-control-flow-structures-without-cfgs/og.png property=og:image><meta content=https://purplesyringa.moe/blog/recovering-control-flow-structures-without-cfgs/ property=og:url><meta content="I’m working on a Java decompiler because I’m not satisfied with the performance of other solutions. I’ve always heard that decompiling JVM bytecode is a solved problem, but I’ve concluded that the decompilation methods used by CFR and Vineflower are hacky, inefficient, and sometimes don’t even work. The existing solutions are haphazard and inadequate compared to alternative approaches.
Specifically, I have beef with the control flow extraction strategies employed by most decompilers. I haven’t tackled decompilation as a whole yet, but I’ve found an approach to control flow recovery that works in isolation, is quite modular, and addresses common frustrations. I don’t claim to be the first person to think of this method, but I haven’t seen it mentioned anywhere, so this post describes it hoping that it’s useful to someone else."property=og:description><meta content=en_US property=og:locale><meta content="purplesyringa's blog"property=og:site_name><meta content=summary_large_image name=twitter:card><meta content=https://purplesyringa.moe/blog/recovering-control-flow-structures-without-cfgs/og.png name=twitter:image><script data-website-id=0da1961d-43f2-45cc-a8e2-75679eefbb69 defer src=https://zond.tei.su/script.js></script><body><header><div class=viewport-container><div class=media><a href=https://github.com/purplesyringa><img alt=GitHub src=../../images/github-mark-white.svg></a></div><h1><a href=/>purplesyringa</a></h1><nav><a href=../..>about</a><a class=current href=../../blog/>blog</a><a href=../../sink/>kitchen sink</a></nav></div></header><section><div class=viewport-container><h2>Recovering control flow structures without CFGs</h2><time>June 6, 2025</time><a class=discussion href=https://news.ycombinator.com/item?id=44202355><i class="nf nf-md-comment"title=Comment></i> Hacker News</a><a class=discussion href=https://www.reddit.com/r/programming/comments/1l4y5zm/recovering_control_flow_structures_without_cfgs/><i class="nf nf-md-comment"title=Comment></i> Reddit</a><a class=discussion href=https://lobste.rs/s/guet32/recovering_control_flow_structures><i class="nf nf-md-comment"title=Comment></i> Lobsters</a><p>I’m working on a Java decompiler because I’m not satisfied with the performance of other solutions. I’ve always heard that decompiling JVM bytecode is a solved problem, but I’ve concluded that the decompilation methods used by CFR and Vineflower are hacky, inefficient, and sometimes don’t even work. The existing solutions are haphazard and inadequate compared to alternative approaches.<p>Specifically, I have beef with the control flow extraction strategies employed by most decompilers. I haven’t tackled decompilation <em>as a whole</em> yet, but I’ve found an approach to control flow recovery that works in isolation, is quite modular, and addresses common frustrations. I don’t claim to be the first person to think of this method, but I haven’t seen it mentioned anywhere, so this post describes it hoping that it’s useful to someone else.<blockquote><p><strong>Disclaimer</strong>: The approach I describe is tuned for bytecode-based languages, such as Java and Python. There’s a chance that it might apply to native code with modifications, but I have not researched that.</blockquote><p class=next-group><span aria-level=3 class=side-header role=heading><span>Setting the scene</span></span>Most decompilers seem to follow one of these two control flow extraction strategies:<ul><li>They try to match bytecode to atomic structures like <code>if</code> or <code>while</code> directly, or<li>They build a control flow graph and then locate atomic structures inside it.</ul><p>Here are the problems with these approaches.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Just match bytecode</span></span>Despite what people might tell you, javac <em>is</em> an optimizing compiler – kind of, anyway. While it doesn’t perform abstract execution, it can still thread jumps together and track reachability. Java bytecode rarely contains instructions <code>goto a; ... a: goto b</code>, by the magic of javac rewriting <code>goto a</code> to <code>goto b</code>. This means that<pre><code class=language-rust><span class=hljs-keyword>if</span> (cond1) {
    <span class=hljs-keyword>if</span> (cond2) {
        <span class="hljs-title function_ invoke__">f</span>();
    } <span class=hljs-keyword>else</span> {
        <span class="hljs-title function_ invoke__">g</span>();
    }
} <span class=hljs-keyword>else</span> {
    <span class="hljs-title function_ invoke__">h</span>();
}
</code></pre><p>is compiled to<pre><code class=language-c>                <span class=hljs-keyword>if</span> (!cond1) <span class=hljs-keyword>goto</span> outer_else;
                <span class=hljs-keyword>if</span> (!cond2) <span class=hljs-keyword>goto</span> inner_else;
                f();
                <span class=hljs-keyword>goto</span> outside;
inner_else:     g();
                <span class=hljs-keyword>goto</span> outside;
outer_else:     h();
outside:
</code></pre><p>…and not the composition of two <code>if</code>s, which would look like<pre><code class=language-c>                <span class=hljs-keyword>if</span> (!cond1) <span class=hljs-keyword>goto</span> outer_else;
                <span class=hljs-keyword>if</span> (!cond2) <span class=hljs-keyword>goto</span> inner_else;
                f();
                <span class=hljs-keyword>goto</span> inner_outside;
inner_else:     g();
inner_outside:  <span class=hljs-keyword>goto</span> outer_outside;
outer_else:     h();
outer_outside:
</code></pre><p>This gets even more complicated when you recall that constructs like <code>do { .. } while (false);</code> exist, which don’t produce <em>any</em> bytecode, but enable unlimited forward <code>goto</code>s with multi-level <code>break</code>s.<p>Trust me, there’s a <em>ton</em> of special cases in real-world Java bytecode. I’ve tried to write a decompiler based on this approach and it simply falls apart on complicated code.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Just build a CFG</span></span>The CFG is effectively a high-level overview of the control flow situation, and the general approach here is to find simple patterns inside the graph. For example, an <code>if</code> conditional amoutns to a node splitting into two nodes, which are then reunited. No more javac-specific hard-coding! …or that’s how the story was supposed to go.<div class=aside-group><aside><p>To be clear: this is typically not a problem for <em>compilers</em>, as compilers have information about loops and usually only have to handle reducible control flow. This is why LLVM’s <a href=https://github.com/llvm/llvm-project/blob/8f7e57485ee73205e108d74abb5565d5c63beaca/llvm/lib/Target/WebAssembly/WebAssemblyCFGStackify.cpp#L434>WASM stackification implementation</a> is so short and fast. <em>Decompilers</em>, on the other hand, do not have such a luxury. If you’re aware of an alternative algorithm that soundly handles <em>any</em> CFG in quasilinear time while at the same time producing high-quality code for reducible CFGs, please do share.</aside><p>CFG is messy. You can’t recover constructs from inside out because an <code>if</code> might contain a <code>continue</code> and you’d have no idea how to handle such a split, as you don’t even know if it’s a <code>continue</code> or a different control flow construct yet. But if you attempt to parse the CFG in the opposite order, you’ll quickly realize that you need to track connectivity and similar properties. This means that you have to re-run the analysis each time you find a new construct, and suddenly your decompiler is frustratingly slow.</div><p class=next-group><span aria-level=3 class=side-header role=heading><span>My idea</span></span>My approach is as follows. Using the CFG directly is a) slow because it’s a graph without a simple structure, b) bad because it’s unrelated to the original program order. Let’s bring the order back and hope that linearizing the graph allows us to use faster algorithms.<p>Suppose that we have something that <em>looks</em> like an <code>if</code>. We can only translate it to a true <code>if</code> if there are no cross-jumps between the <code>then</code> and <code>else</code> branches. In a CFG, this is a connectivity query; in a linear order, this is a “is there an arrow starting in <eq><math><mrow><mo form=prefix stretchy=false>[</mo><msub><mi>l</mi><mn>1</mn></msub><mo separator=true>;</mo><msub><mi>r</mi><mn>1</mn></msub><mo form=postfix stretchy=false>]</mo></mrow></math></eq> and ending in <eq><math><mrow><mo form=prefix stretchy=false>[</mo><msub><mi>l</mi><mn>2</mn></msub><mo separator=true>;</mo><msub><mi>r</mi><mn>2</mn></msub><mo form=postfix stretchy=false>]</mo></mrow></math></eq>” query, which is much easier to implement and optimize.<p>Of course, reading sequential bytecode, building a control flow graph, and then linearizing it back would be bollocks. If we can trust control flow not to be obfuscated, javac output is <em>already</em> a good instruction order, and our attempts to find a better one will likely produce worse code in the end. Not only does trusting javac provide a better result, but it’s also closer to the source.<div class=aside-group><aside><p>Shut up, I know that AST is already “abstract”, but <em>abstract</em> doesn’t have many synonyms.</aside><p>This might sound like the “just match bytecode” approach, which I’ve just criticized, so let me explain the difference. The “just match bytecode” gang attempts to immediately match <code>if</code>, <code>while</code>, and other CF constructs. <em>My</em> goal is to build a very abstract AST, where nodes aren’t labeled with any specific high-level constructs, and then refine this abstract AST to a concrete one. This closely mirrors the CFG approach but uses a tree rather than a graph.</div><p class=next-group><span aria-level=3 class=side-header role=heading><span>Abstract AST</span></span>We’re now deep into the unexplored territory. A few papers come close, but there’s nothing specifically like this, so let me introduce some terminology. You might be familiar with some of it from this work, which we’ll build upon in a moment:<blockquote><p>Lyle Ramshaw. 1988. Eliminating go to’s while preserving program structure. J. ACM 35, 4 (Oct. 1988), 893–920. <a href=https://doi.org/10.1145/48014.48021>https://doi.org/10.1145/48014.48021</a></blockquote><p>An input program is a list of statements, where each statement is either an atom (i.e. an unsplittable instruction without any control flow) or a (possibly conditional) <code>goto</code>:<pre><code class=language-rust><span class=hljs-keyword>enum</span> <span class="hljs-title class_">InputStatement</span> {
    <span class="hljs-title function_ invoke__">Atom</span>(Atom),
    <span class="hljs-title function_ invoke__">Goto</span>(Condition, StatementId),
}
</code></pre><p>An output program is a list of statements: either an atom, or a labeled <em>block</em> containing other statements, or a (possibly conditional, possibly multi-level) <code>continue</code> or <code>break</code> from a block:<pre><code class=language-rust><span class=hljs-keyword>enum</span> <span class="hljs-title class_">OutputStatement</span> {
    <span class="hljs-title function_ invoke__">Atom</span>(Atom),
    <span class="hljs-title function_ invoke__">Block</span>(BlockId, <span class=hljs-type>Vec</span>&LTOutputStatement>),
    <span class="hljs-title function_ invoke__">Continue</span>(Condition, BlockId),
    <span class="hljs-title function_ invoke__">Break</span>(Condition, BlockId),
}
</code></pre><p>When executed, a block executes all its children and exits. It does not form a loop, and it’s not a functional control flow construct by itself, but it forms the basis of other constructs. Specifically, <code>break</code>ing a block jumps to the statement after the block, and <code>continue</code>ing a block jumps to the <em>beginning</em> of the block. For example,<pre><code class=language-rust><span class=hljs-keyword>while</span> (x != <span class=hljs-number>10</span>) {
    x++;
}
</code></pre><p>can be implemented as<pre><code class=language-rust>block #<span class=hljs-number>1</span> {
    <span class=hljs-keyword>if</span> (x == <span class=hljs-number>10</span>) <span class=hljs-keyword>break</span> #<span class=hljs-number>1</span>;
    x++;
    <span class=hljs-keyword>continue</span> #<span class=hljs-number>1</span>;
}
</code></pre><p>Blocks kind of mirror CFG nodes, in that they contain statements and can be branched to, while <code>break</code>s and <code>continue</code>s are ways to simulate structured <code>goto</code>.<p>A <em>gap</em> is the space between consecutive statements in the input program. An <em>arrow</em> is an arrow connecting two gaps in a particular direction.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Blocks</span></span>I’m using blocks instead of any other construct because they do not introduce any control flow that hasn’t been present in the bytecode. I’m also not making a difference between blocks that only support <code>break</code> and blocks that only support <code>continue</code>, as the paper does: I acknowledge that real-world programs often have what amounts to both <code>continue</code> and <code>break</code> in the same loop, and that making this unnatural split is counterproductive.<p>Let’s talk about the end goal. If we manage to produce a minimal (in some sense) abstract AST, we can <em>then</em> pattern-match it to well-known constructs. For example,<pre><code class=language-rust>block #n {
    <span class=hljs-keyword>if</span> (cond) <span class=hljs-keyword>break</span> #n;
    &LTsomething not containing any mention of #n>
}
</code></pre><p>…is certainly just an <code>if</code>, and<pre><code class=language-rust>block #n {
    <span class=hljs-keyword>if</span> (cond) <span class=hljs-keyword>break</span> #n;
    &LTstatements...>
    &LTa divergent statement>
}
</code></pre><p>…is equivalent to a <code>while</code>. Note how tricky this second example is: we can parse a <code>while</code> <em>without hard-coding <code>continue #n</code> at the end</em>. <code>continue #n</code> is necessarily divergent, but so is an <code>if</code> statement with <code>continue #n</code> in one branch and <code>return</code> in the other one.<p>We’ll get into the specifics more soon, but you can see that although it <em>seems</em> like we’re just hard-coding control flow structures, the patterns we match are much more general than bytecode matching could ever achieve. By designing later passes carefully, you can gracefully recover <em>all</em> control flow structures from the original code, regardless of their complexity or code optimization.<p>Atypical blocks can be lowered to <code>while (true) { ... break; }</code>. <em>In reality</em>, this is a special case of the <code>while</code> lowering (or should I say upping?), but it’s useful to understand that there’s always a simple fallback if push comes to shove.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Ramshaw’s approach</span></span>To construct blocks, we’ll first need to build an <em>arrow set</em>. An arrow set succinctly represents the structure of all jumps a program can take. The presence of an arrow <eq><math><mrow><mi>x</mi><mo>→</mo></mrow><mrow><mi>y</mi></mrow></math></eq> in the set indicates that <em>some</em> statement between the gaps <eq><math><mi>x</mi></math></eq> and <eq><math><mi>y</mi></math></eq> wants to jump to gap <eq><math><mi>y</mi></math></eq>. To build an arrow set, we use the targets of <code>goto</code>s as the heads and insert the shortest arrows containing the <code>goto</code> statements themselves.<p>Ramshaw’s paper makes use of these two core facts:<ol><li>If the arrows form a tree, i.e. any two intersecting arrows are nested, the arrows can be directly translated to blocks. If the arrow points forward, all jumps to its head can be implemented with a multi-level <code>break</code>, and if it points backward, <code>continue</code> does the trick.<li>The <em>tail</em> of any arrow can be arbitrarily extended without making any jumps unimplementable.</ol><p>The paper explains precisely how to expand the arrows’ tails to make them form a tree, but this is where we need to depart from the classics. This approach ignores that <em>not all arrows represent logical blocks</em>. <code>continue</code> and <code>break</code> statements will be parsed as arrows, and if those are treated equivalently to natural control flow construct arrows, the generated code will get chaotic <em>even if</em> you try to optimize them out after arrow extension. Specifically, consider the following two cases:<div class="diagram only-light"><svg viewbox="-71.402502 -68.679573 255.12113 110.570268"height=110.570268pt version=1.1 width=255.12113pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d=M3.060523-3.16812V-4.052802H.215193V-3.16812H3.060523Z id=g0-45 /><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M6.168867-3.084433V-3.180075C6.168867-4.184309 5.941719-4.985305 5.511333-5.559153C5.068991-6.133001 4.471233-6.43188 3.706102-6.43188S2.331258-6.156912 1.900872-5.618929V-8.966376H.812951V0H1.80523L1.865006-.729265C2.295392-.155417 2.917061 .119552 3.718057 .119552C4.459278 .119552 5.045081-.167372 5.499377-.753176C5.941719-1.338979 6.168867-2.116065 6.168867-3.084433ZM5.080946-3.21594C5.080946-2.402989 4.937484-1.80523 4.65056-1.398755S3.957161-.800996 3.443088-.800996C2.749689-.800996 2.235616-1.123786 1.900872-1.793275V-4.519054C2.211706-5.176588 2.713823-5.511333 3.431133-5.511333C3.957161-5.511333 4.363636-5.308095 4.65056-4.913574C4.937484-4.507098 5.080946-3.945205 5.080946-3.21594Z"id=g0-98 /><path d="M3.347447-.765131C2.785554-.765131 2.355168-.956413 2.056289-1.350934S1.613948-2.307347 1.613948-3.036613V-3.239851C1.613948-3.981071 1.75741-4.554919 2.068244-4.94944C2.367123-5.34396 2.797509-5.547198 3.347447-5.547198C3.753923-5.547198 4.088667-5.415691 4.375592-5.152677C4.65056-4.889664 4.805978-4.554919 4.841843-4.148443H5.858032C5.822167-4.817933 5.571108-5.36787 5.104857-5.798257C4.638605-6.216687 4.052802-6.43188 3.347447-6.43188C2.773599-6.43188 2.271482-6.300374 1.853051-6.03736C1.422665-5.774346 1.099875-5.391781 .872727-4.913574S.537983-3.88543 .537983-3.275716V-3.096389C.537983-2.092154 .789041-1.315068 1.291158-.74122S2.486675 .119552 3.347447 .119552C3.777833 .119552 4.184309 .02391 4.566874-.167372S5.248319-.621669 5.487422-.956413C5.71457-1.291158 5.834122-1.637858 5.858032-1.996513H4.841843C4.805978-1.637858 4.638605-1.350934 4.351681-1.111831S3.730012-.765131 3.347447-.765131Z"id=g0-99 /><path d="M3.443088 .119552C4.495143 .119552 5.296139-.286924 5.822167-1.099875L5.164633-1.613948C4.961395-1.350934 4.722291-1.147696 4.459278-.992279S3.873474-.765131 3.490909-.765131C2.952927-.765131 2.510585-.956413 2.163885-1.338979S1.637858-2.223661 1.625903-2.84533H5.905853V-3.299626C5.905853-4.303861 5.66675-5.068991 5.212453-5.618929C4.758157-6.156912 4.112578-6.43188 3.299626-6.43188C2.797509-6.43188 2.331258-6.288418 1.900872-6.01345C1.470486-5.726526 1.135741-5.34396 .896638-4.853798S.537983-3.801743 .537983-3.180075V-2.988792C.537983-2.032379 .800996-1.279203 1.350934-.71731C1.888917-.155417 2.582316 .119552 3.443088 .119552ZM3.299626-5.547198C3.753923-5.547198 4.112578-5.391781 4.375592-5.092902C4.638605-4.782067 4.782067-4.363636 4.817933-3.813699V-3.730012H1.661768C1.721544-4.303861 1.900872-4.746202 2.199751-5.068991C2.486675-5.379826 2.857285-5.547198 3.299626-5.547198Z"id=g0-101 /><path d="M1.350934 0H2.426899V-5.475467H3.777833V-6.312329H2.426899V-6.981818C2.426899-7.364384 2.52254-7.651308 2.713823-7.854545S3.16812-8.16538 3.526775-8.16538C3.730012-8.16538 3.921295-8.141469 4.112578-8.117559L4.172354-8.990286C3.921295-9.050062 3.670237-9.085928 3.431133-9.085928C2.761644-9.085928 2.247572-8.894645 1.888917-8.53599C1.530262-8.16538 1.350934-7.639352 1.350934-6.969863V-6.312329H.3467V-5.475467H1.350934V0Z"id=g0-102 /><path d="M1.900872-5.547198V-8.966376H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C3.000747-6.43188 2.379078-6.133001 1.900872-5.547198Z"id=g0-104 /><path d="M1.996513 0V-6.312329H.908593V0H1.996513ZM.824907-7.986052C.824907-7.806725 .872727-7.663263 .980324-7.543711S1.243337-7.376339 1.458531-7.376339C1.661768-7.376339 1.817186-7.424159 1.936737-7.543711C2.044334-7.663263 2.10411-7.806725 2.10411-7.986052C2.10411-8.153425 2.044334-8.308842 1.936737-8.428394C1.817186-8.547945 1.661768-8.619676 1.458531-8.619676C1.243337-8.619676 1.08792-8.547945 .980324-8.428394S.824907-8.153425 .824907-7.986052Z"id=g0-105 /><path d="M2.582316-2.929016L4.782067 0H6.049315L3.299626-3.682192L5.762391-6.312329H4.447323L2.486675-4.23213L1.900872-3.53873V-8.966376H.824907V0H1.900872V-2.223661L2.582316-2.929016Z"id=g0-107 /><path d="M1.996513 0V-8.966376H.908593V0H1.996513Z"id=g0-108 /><path d="M1.829141-6.312329H.812951V0H1.888917V-4.614695C2.15193-5.212453 2.630137-5.511333 3.347447-5.511333C4.244085-5.511333 4.698381-5.045081 4.698381-4.136488V0H5.774346V-4.196264C5.822167-4.590785 5.977584-4.913574 6.240598-5.152677S6.826401-5.511333 7.232877-5.511333C7.723039-5.511333 8.069738-5.391781 8.272976-5.176588S8.583811-4.62665 8.583811-4.172354V0H9.671731V-4.23213C9.647821-5.69066 8.942466-6.43188 7.555666-6.43188C7.089415-6.43188 6.682939-6.336239 6.348194-6.144956S5.738481-5.71457 5.535243-5.415691C5.212453-6.085181 4.614695-6.43188 3.730012-6.43188C2.940971-6.43188 2.319303-6.156912 1.865006-5.618929L1.829141-6.312329Z"id=g0-109 /><path d="M1.841096-6.312329H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C2.988792-6.43188 2.355168-6.121046 1.876961-5.523288L1.841096-6.312329Z"id=g0-110 /><path d="M.526027-3.21594V-3.144209C.526027-2.163885 .789041-1.374844 1.327024-.777086C1.853051-.179328 2.546451 .119552 3.407223 .119552C3.969116 .119552 4.471233-.011955 4.913574-.286924C5.34396-.561893 5.678705-.944458 5.917808-1.43462C6.156912-1.912827 6.276463-2.462765 6.276463-3.084433V-3.16812C6.276463-4.148443 6.001494-4.937484 5.475467-5.535243S4.25604-6.43188 3.395268-6.43188C2.833375-6.43188 2.331258-6.288418 1.900872-6.025405S1.123786-5.379826 .884682-4.889664C.645579-4.387547 .526027-3.837609 .526027-3.21594ZM1.613948-3.084433C1.613948-3.873474 1.769365-4.471233 2.10411-4.901619C2.426899-5.332005 2.857285-5.547198 3.395268-5.547198C3.945205-5.547198 4.375592-5.332005 4.710336-4.901619C5.033126-4.471233 5.200498-3.90934 5.200498-3.21594C5.200498-2.438854 5.033126-1.841096 4.710336-1.41071S3.957161-.765131 3.407223-.765131S2.426899-.968369 2.10411-1.398755C1.769365-1.817186 1.613948-2.379078 1.613948-3.084433Z"id=g0-111 /><path d="M3.873474-5.34396V-6.348194C3.753923-6.396015 3.598506-6.43188 3.395268-6.43188C2.737733-6.43188 2.235616-6.144956 1.888917-5.583064L1.865006-6.312329H.812951V0H1.900872V-4.483188C2.139975-5.080946 2.618182-5.391781 3.335492-5.391781C3.526775-5.379826 3.706102-5.36787 3.873474-5.34396Z"id=g0-114 /><path d="M2.283437-7.84259H1.207472V-6.312329H.047821V-5.475467H1.207472V-1.566127C1.207472-1.016189 1.327024-.597758 1.566127-.310834S2.175841 .119552 2.666002 .119552C2.929016 .119552 3.203985 .083686 3.490909 0V-.872727C3.275716-.824907 3.096389-.800996 2.976837-.800996C2.713823-.800996 2.534496-.860772 2.438854-.992279C2.331258-1.111831 2.283437-1.303113 2.283437-1.566127V-5.475467H3.466999V-6.312329H2.283437V-7.84259Z"id=g0-116 /><path d="M4.722291-.621669L4.734247 0H5.762391V-6.312329H4.686426V-1.721544C4.411457-1.099875 3.861519-.800996 3.036613-.800996C2.259527-.800996 1.876961-1.279203 1.876961-2.235616V-6.312329H.789041V-2.211706C.789041-1.43462 .968369-.848817 1.327024-.466252C1.685679-.071731 2.199751 .119552 2.86924 .119552C3.682192 .119552 4.291905-.119552 4.722291-.621669Z"id=g0-117 /><path d="M2.905106-1.470486L1.291158-6.312329H.191283L2.486675 0H3.299626L5.571108-6.312329H4.471233L2.905106-1.470486Z"id=g0-118 /><path d="M6.40797-1.494396L4.913574-6.312329H4.040847L2.570361-1.590037L1.327024-6.312329H.251059L2.080199 0H2.964882L4.459278-4.782067L5.989539 0H6.862267L8.703362-6.312329H7.627397L6.40797-1.494396Z"id=g0-119 /></defs><g id=page1><path d=M-70.20703-56.082033H98.6797 fill=none stroke=#f33 stroke-width=1.19553 /><path d=M-67.77739-52.25C-68.32817-54.55078-69.56255-55.63672-70.804737-56.082033C-69.56255-56.527345-68.32817-57.61328-67.77739-59.91406 fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><g transform="matrix(1 0 0 1 62.06831 -4.0379)"><use x=-71.402255 xlink:href=#g0-99 y=-56.081777 /><use x=-65.149705 xlink:href=#g0-111 y=-56.081777 /><use x=-58.335263 xlink:href=#g0-110 y=-56.081777 /><use x=-51.747969 xlink:href=#g0-116 y=-56.081777 /><use x=-47.850582 xlink:href=#g0-105 y=-56.081777 /><use x=-44.957436 xlink:href=#g0-110 y=-56.081777 /><use x=-38.370142 xlink:href=#g0-117 y=-56.081777 /><use x=-31.782849 xlink:href=#g0-101 y=-56.081777 /></g><path d=M13.6367-33.4023H182.5237 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M180.09352-37.2344C180.6443-34.93752 181.87868-33.851585 183.120863-33.402366C181.87868-32.957053 180.6443-31.87112 180.09352-29.57424"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 166.56 18.7592)"><use x=-71.402255 xlink:href=#g0-105 y=-56.081777 /><use x=-68.509109 xlink:href=#g0-102 y=-56.081777 /></g><path d="M-70.20703 14.7852H98.6797"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-67.77739 18.61719C-68.32817 16.31641-69.56255 15.230471-70.804737 14.785158C-69.56255 14.339846-68.32817 13.25391-67.77739 10.95313"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 71.208155 66.8291)"><use x=-71.402255 xlink:href=#g0-119 y=-56.081777 /><use x=-62.423919 xlink:href=#g0-104 y=-56.081777 /><use x=-55.848574 xlink:href=#g0-105 y=-56.081777 /><use x=-52.955428 xlink:href=#g0-108 y=-56.081777 /><use x=-50.062282 xlink:href=#g0-101 y=-56.081777 /></g><path d="M13.6367 37.4609H182.5237"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M180.09352 33.63277C180.6443 35.92965 181.87868 37.015583 183.120863 37.460896C181.87868 37.910114 180.6443 38.99605 180.09352 41.29293"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 126.7967 89.5067)"><use x=-71.402255 xlink:href=#g0-109 y=-56.081777 /><use x=-60.929523 xlink:href=#g0-117 y=-56.081777 /><use x=-54.34223 xlink:href=#g0-108 y=-56.081777 /><use x=-51.449083 xlink:href=#g0-116 y=-56.081777 /><use x=-47.551696 xlink:href=#g0-105 y=-56.081777 /><use x=-44.65855 xlink:href=#g0-45 y=-56.081777 /><use x=-41.370883 xlink:href=#g0-108 y=-56.081777 /><use x=-38.477737 xlink:href=#g0-101 y=-56.081777 /><use x=-32.225187 xlink:href=#g0-118 y=-56.081777 /><use x=-26.51062 xlink:href=#g0-101 y=-56.081777 /><use x=-20.186333 xlink:href=#g0-108 y=-56.081777 /><use x=-14.340271 xlink:href=#g0-98 y=-56.081777 /><use x=-7.633423 xlink:href=#g0-114 y=-56.081777 /><use x=-3.700171 xlink:href=#g0-101 y=-56.081777 /><use x=2.624116 xlink:href=#g0-97 y=-56.081777 /><use x=9.115775 xlink:href=#g0-107 y=-56.081777 /></g></g><title>Both cases have two arrows with a tail-to-tail conflict: the left arrow points backward, while the right arrow points forward. In the first example, the left arrow is a continue and the right arrow is from an if statement. In the second example, the left arrow is from a while statement and the right arrow is a multi-level break.</title></svg></div><div class="diagram only-dark"><svg viewbox="-71.402502 -68.679573 255.12113 110.570268"height=110.570268pt version=1.1 width=255.12113pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d=M3.060523-3.16812V-4.052802H.215193V-3.16812H3.060523Z id=g0-45 /><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M6.168867-3.084433V-3.180075C6.168867-4.184309 5.941719-4.985305 5.511333-5.559153C5.068991-6.133001 4.471233-6.43188 3.706102-6.43188S2.331258-6.156912 1.900872-5.618929V-8.966376H.812951V0H1.80523L1.865006-.729265C2.295392-.155417 2.917061 .119552 3.718057 .119552C4.459278 .119552 5.045081-.167372 5.499377-.753176C5.941719-1.338979 6.168867-2.116065 6.168867-3.084433ZM5.080946-3.21594C5.080946-2.402989 4.937484-1.80523 4.65056-1.398755S3.957161-.800996 3.443088-.800996C2.749689-.800996 2.235616-1.123786 1.900872-1.793275V-4.519054C2.211706-5.176588 2.713823-5.511333 3.431133-5.511333C3.957161-5.511333 4.363636-5.308095 4.65056-4.913574C4.937484-4.507098 5.080946-3.945205 5.080946-3.21594Z"id=g0-98 /><path d="M3.347447-.765131C2.785554-.765131 2.355168-.956413 2.056289-1.350934S1.613948-2.307347 1.613948-3.036613V-3.239851C1.613948-3.981071 1.75741-4.554919 2.068244-4.94944C2.367123-5.34396 2.797509-5.547198 3.347447-5.547198C3.753923-5.547198 4.088667-5.415691 4.375592-5.152677C4.65056-4.889664 4.805978-4.554919 4.841843-4.148443H5.858032C5.822167-4.817933 5.571108-5.36787 5.104857-5.798257C4.638605-6.216687 4.052802-6.43188 3.347447-6.43188C2.773599-6.43188 2.271482-6.300374 1.853051-6.03736C1.422665-5.774346 1.099875-5.391781 .872727-4.913574S.537983-3.88543 .537983-3.275716V-3.096389C.537983-2.092154 .789041-1.315068 1.291158-.74122S2.486675 .119552 3.347447 .119552C3.777833 .119552 4.184309 .02391 4.566874-.167372S5.248319-.621669 5.487422-.956413C5.71457-1.291158 5.834122-1.637858 5.858032-1.996513H4.841843C4.805978-1.637858 4.638605-1.350934 4.351681-1.111831S3.730012-.765131 3.347447-.765131Z"id=g0-99 /><path d="M3.443088 .119552C4.495143 .119552 5.296139-.286924 5.822167-1.099875L5.164633-1.613948C4.961395-1.350934 4.722291-1.147696 4.459278-.992279S3.873474-.765131 3.490909-.765131C2.952927-.765131 2.510585-.956413 2.163885-1.338979S1.637858-2.223661 1.625903-2.84533H5.905853V-3.299626C5.905853-4.303861 5.66675-5.068991 5.212453-5.618929C4.758157-6.156912 4.112578-6.43188 3.299626-6.43188C2.797509-6.43188 2.331258-6.288418 1.900872-6.01345C1.470486-5.726526 1.135741-5.34396 .896638-4.853798S.537983-3.801743 .537983-3.180075V-2.988792C.537983-2.032379 .800996-1.279203 1.350934-.71731C1.888917-.155417 2.582316 .119552 3.443088 .119552ZM3.299626-5.547198C3.753923-5.547198 4.112578-5.391781 4.375592-5.092902C4.638605-4.782067 4.782067-4.363636 4.817933-3.813699V-3.730012H1.661768C1.721544-4.303861 1.900872-4.746202 2.199751-5.068991C2.486675-5.379826 2.857285-5.547198 3.299626-5.547198Z"id=g0-101 /><path d="M1.350934 0H2.426899V-5.475467H3.777833V-6.312329H2.426899V-6.981818C2.426899-7.364384 2.52254-7.651308 2.713823-7.854545S3.16812-8.16538 3.526775-8.16538C3.730012-8.16538 3.921295-8.141469 4.112578-8.117559L4.172354-8.990286C3.921295-9.050062 3.670237-9.085928 3.431133-9.085928C2.761644-9.085928 2.247572-8.894645 1.888917-8.53599C1.530262-8.16538 1.350934-7.639352 1.350934-6.969863V-6.312329H.3467V-5.475467H1.350934V0Z"id=g0-102 /><path d="M1.900872-5.547198V-8.966376H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C3.000747-6.43188 2.379078-6.133001 1.900872-5.547198Z"id=g0-104 /><path d="M1.996513 0V-6.312329H.908593V0H1.996513ZM.824907-7.986052C.824907-7.806725 .872727-7.663263 .980324-7.543711S1.243337-7.376339 1.458531-7.376339C1.661768-7.376339 1.817186-7.424159 1.936737-7.543711C2.044334-7.663263 2.10411-7.806725 2.10411-7.986052C2.10411-8.153425 2.044334-8.308842 1.936737-8.428394C1.817186-8.547945 1.661768-8.619676 1.458531-8.619676C1.243337-8.619676 1.08792-8.547945 .980324-8.428394S.824907-8.153425 .824907-7.986052Z"id=g0-105 /><path d="M2.582316-2.929016L4.782067 0H6.049315L3.299626-3.682192L5.762391-6.312329H4.447323L2.486675-4.23213L1.900872-3.53873V-8.966376H.824907V0H1.900872V-2.223661L2.582316-2.929016Z"id=g0-107 /><path d="M1.996513 0V-8.966376H.908593V0H1.996513Z"id=g0-108 /><path d="M1.829141-6.312329H.812951V0H1.888917V-4.614695C2.15193-5.212453 2.630137-5.511333 3.347447-5.511333C4.244085-5.511333 4.698381-5.045081 4.698381-4.136488V0H5.774346V-4.196264C5.822167-4.590785 5.977584-4.913574 6.240598-5.152677S6.826401-5.511333 7.232877-5.511333C7.723039-5.511333 8.069738-5.391781 8.272976-5.176588S8.583811-4.62665 8.583811-4.172354V0H9.671731V-4.23213C9.647821-5.69066 8.942466-6.43188 7.555666-6.43188C7.089415-6.43188 6.682939-6.336239 6.348194-6.144956S5.738481-5.71457 5.535243-5.415691C5.212453-6.085181 4.614695-6.43188 3.730012-6.43188C2.940971-6.43188 2.319303-6.156912 1.865006-5.618929L1.829141-6.312329Z"id=g0-109 /><path d="M1.841096-6.312329H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C2.988792-6.43188 2.355168-6.121046 1.876961-5.523288L1.841096-6.312329Z"id=g0-110 /><path d="M.526027-3.21594V-3.144209C.526027-2.163885 .789041-1.374844 1.327024-.777086C1.853051-.179328 2.546451 .119552 3.407223 .119552C3.969116 .119552 4.471233-.011955 4.913574-.286924C5.34396-.561893 5.678705-.944458 5.917808-1.43462C6.156912-1.912827 6.276463-2.462765 6.276463-3.084433V-3.16812C6.276463-4.148443 6.001494-4.937484 5.475467-5.535243S4.25604-6.43188 3.395268-6.43188C2.833375-6.43188 2.331258-6.288418 1.900872-6.025405S1.123786-5.379826 .884682-4.889664C.645579-4.387547 .526027-3.837609 .526027-3.21594ZM1.613948-3.084433C1.613948-3.873474 1.769365-4.471233 2.10411-4.901619C2.426899-5.332005 2.857285-5.547198 3.395268-5.547198C3.945205-5.547198 4.375592-5.332005 4.710336-4.901619C5.033126-4.471233 5.200498-3.90934 5.200498-3.21594C5.200498-2.438854 5.033126-1.841096 4.710336-1.41071S3.957161-.765131 3.407223-.765131S2.426899-.968369 2.10411-1.398755C1.769365-1.817186 1.613948-2.379078 1.613948-3.084433Z"id=g0-111 /><path d="M3.873474-5.34396V-6.348194C3.753923-6.396015 3.598506-6.43188 3.395268-6.43188C2.737733-6.43188 2.235616-6.144956 1.888917-5.583064L1.865006-6.312329H.812951V0H1.900872V-4.483188C2.139975-5.080946 2.618182-5.391781 3.335492-5.391781C3.526775-5.379826 3.706102-5.36787 3.873474-5.34396Z"id=g0-114 /><path d="M2.283437-7.84259H1.207472V-6.312329H.047821V-5.475467H1.207472V-1.566127C1.207472-1.016189 1.327024-.597758 1.566127-.310834S2.175841 .119552 2.666002 .119552C2.929016 .119552 3.203985 .083686 3.490909 0V-.872727C3.275716-.824907 3.096389-.800996 2.976837-.800996C2.713823-.800996 2.534496-.860772 2.438854-.992279C2.331258-1.111831 2.283437-1.303113 2.283437-1.566127V-5.475467H3.466999V-6.312329H2.283437V-7.84259Z"id=g0-116 /><path d="M4.722291-.621669L4.734247 0H5.762391V-6.312329H4.686426V-1.721544C4.411457-1.099875 3.861519-.800996 3.036613-.800996C2.259527-.800996 1.876961-1.279203 1.876961-2.235616V-6.312329H.789041V-2.211706C.789041-1.43462 .968369-.848817 1.327024-.466252C1.685679-.071731 2.199751 .119552 2.86924 .119552C3.682192 .119552 4.291905-.119552 4.722291-.621669Z"id=g0-117 /><path d="M2.905106-1.470486L1.291158-6.312329H.191283L2.486675 0H3.299626L5.571108-6.312329H4.471233L2.905106-1.470486Z"id=g0-118 /><path d="M6.40797-1.494396L4.913574-6.312329H4.040847L2.570361-1.590037L1.327024-6.312329H.251059L2.080199 0H2.964882L4.459278-4.782067L5.989539 0H6.862267L8.703362-6.312329H7.627397L6.40797-1.494396Z"id=g0-119 /></defs><g id=page1><path d=M-70.20703-56.082033H98.6797 fill=none stroke=#e64d80 stroke-width=1.19553 /><path d=M-67.77739-52.25C-68.32817-54.55078-69.56255-55.63672-70.804737-56.082033C-69.56255-56.527345-68.32817-57.61328-67.77739-59.91406 fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><g transform="matrix(1 0 0 1 62.06831 -4.0379)"fill=#fff><use x=-71.402255 xlink:href=#g0-99 y=-56.081777 /><use x=-65.149705 xlink:href=#g0-111 y=-56.081777 /><use x=-58.335263 xlink:href=#g0-110 y=-56.081777 /><use x=-51.747969 xlink:href=#g0-116 y=-56.081777 /><use x=-47.850582 xlink:href=#g0-105 y=-56.081777 /><use x=-44.957436 xlink:href=#g0-110 y=-56.081777 /><use x=-38.370142 xlink:href=#g0-117 y=-56.081777 /><use x=-31.782849 xlink:href=#g0-101 y=-56.081777 /></g><path d=M13.6367-33.4023H182.5237 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M180.09352-37.2344C180.6443-34.93752 181.87868-33.851585 183.120863-33.402366C181.87868-32.957053 180.6443-31.87112 180.09352-29.57424"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 166.56 18.7592)"fill=#fff><use x=-71.402255 xlink:href=#g0-105 y=-56.081777 /><use x=-68.509109 xlink:href=#g0-102 y=-56.081777 /></g><path d="M-70.20703 14.7852H98.6797"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-67.77739 18.61719C-68.32817 16.31641-69.56255 15.230471-70.804737 14.785158C-69.56255 14.339846-68.32817 13.25391-67.77739 10.95313"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 71.208155 66.8291)"fill=#fff><use x=-71.402255 xlink:href=#g0-119 y=-56.081777 /><use x=-62.423919 xlink:href=#g0-104 y=-56.081777 /><use x=-55.848574 xlink:href=#g0-105 y=-56.081777 /><use x=-52.955428 xlink:href=#g0-108 y=-56.081777 /><use x=-50.062282 xlink:href=#g0-101 y=-56.081777 /></g><path d="M13.6367 37.4609H182.5237"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M180.09352 33.63277C180.6443 35.92965 181.87868 37.015583 183.120863 37.460896C181.87868 37.910114 180.6443 38.99605 180.09352 41.29293"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 126.7967 89.5067)"fill=#fff><use x=-71.402255 xlink:href=#g0-109 y=-56.081777 /><use x=-60.929523 xlink:href=#g0-117 y=-56.081777 /><use x=-54.34223 xlink:href=#g0-108 y=-56.081777 /><use x=-51.449083 xlink:href=#g0-116 y=-56.081777 /><use x=-47.551696 xlink:href=#g0-105 y=-56.081777 /><use x=-44.65855 xlink:href=#g0-45 y=-56.081777 /><use x=-41.370883 xlink:href=#g0-108 y=-56.081777 /><use x=-38.477737 xlink:href=#g0-101 y=-56.081777 /><use x=-32.225187 xlink:href=#g0-118 y=-56.081777 /><use x=-26.51062 xlink:href=#g0-101 y=-56.081777 /><use x=-20.186333 xlink:href=#g0-108 y=-56.081777 /><use x=-14.340271 xlink:href=#g0-98 y=-56.081777 /><use x=-7.633423 xlink:href=#g0-114 y=-56.081777 /><use x=-3.700171 xlink:href=#g0-101 y=-56.081777 /><use x=2.624116 xlink:href=#g0-97 y=-56.081777 /><use x=9.115775 xlink:href=#g0-107 y=-56.081777 /></g></g><title>Both cases have two arrows with a tail-to-tail conflict: the left arrow points backward, while the right arrow points forward. In the first example, the left arrow is a continue and the right arrow is from an if statement. In the second example, the left arrow is from a while statement and the right arrow is a multi-level break.</title></svg></div><p>There’s no <em>local</em> way to decide which arrow represents <code>continue</code>/<code>break</code> and which one represents a control flow construct, so at least in one of those cases, the arrow corresponding to the CF statement will have its tail extended, and thus the block won’t be parsed as a high-level construct. This might make <em>that</em> arrow intersect another arrow not represented here, triggering more and more extensions like ripples in the water, which will be a nightmare to roll back if and when we decide the <code>break</code> and <code>continue</code> arrows can be optimized out.<p>This is where the Relooper and <a href=https://medium.com/leaningtech/solving-the-structured-control-flow-problem-once-and-for-all-5123117b1ee2>Stackifier</a> approaches fundamentally get stuck. You can see from the linked article that Stackifier cannot restore good-quality high-level control flow because they attempt to create blocks that do not and <em>cannot</em> exist in the source.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Alternative</span></span>Here’s an alternative approach.<p>We construct the blocks from the outside. This allows us to ignore arrows that can be implemented with <code>continue</code> or <code>break</code>, as all the blocks that could have satisfied them have already been built. Here’s specifically how we do that.<p>We define a recursive procedure <eq><math><mrow><mrow><mtext></mtext><mi>build</mi></mrow><mo form=prefix stretchy=false>(</mo><mi>l</mi><mo separator=true>,</mo><mi>r</mi><mo form=postfix stretchy=false>)</mo></mrow></math></eq> that parses the statements in range <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq>. We find <em>split gaps</em> inside this range, i.e. gaps that no arrows cross. If such gaps are present, we split the <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> interval into smaller intervals and recurse. If no split gaps are present, either the <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> range covers just one statement, which is trivial to handle, or there’s multiple statements covered by the union of arrows.<p>In the latter case, we <em>have</em> to create a block covering the entire <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> range: it can be proven that any smaller block would either conflict with arrows or not resolve any “topmost” arrow. Creating such a block allows us to satisfy all jumps to <eq><math><mi>l</mi></math></eq> and <eq><math><mi>r</mi></math></eq> from within the range with <code>continue</code> and <code>break</code>, respectively, and remove all the corresponding arrows from the arrow set.<p>In <em>most</em> cases, new split gaps will appear at this point, allowing us to recurse, and that’s the whole algorithm.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Irreducibility</span></span>But <em>sometimes</em>, no new split gaps appear. To be specific, as we haven’t removed forward arrows from <eq><math><mi>l</mi></math></eq> and backward arrows from <eq><math><mi>r</mi></math></eq>, no new gaps can appear in cases like this:<div class="diagram only-light"><svg viewbox="-72.000111 -72.000105 313.011576 75.876793"height=75.876793pt version=1.1 width=313.011576pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M2.199751-.573848C2.199751-.920548 1.912827-1.159651 1.625903-1.159651C1.279203-1.159651 1.0401-.872727 1.0401-.585803C1.0401-.239103 1.327024 0 1.613948 0C1.960648 0 2.199751-.286924 2.199751-.573848Z"id=g0-58 /></defs><g id=page1><path d=M-71.402346-67.57031H12.4414 fill=none stroke=#f33 stroke-width=1.19553 /><path d="M10.01176-71.40234C10.56645-69.10547 11.79692-68.019529 13.039103-67.57031C11.79692-67.124997 10.56645-66.03906 10.01176-63.74218"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-53.3984H69.1367 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-57.23046C67.25782-54.92967 68.49219-53.843737 69.734381-53.398424C68.49219-52.953112 67.25782-51.86717 66.70704-49.56639"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-39.2266H125.8277 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-43.05469C123.95351-40.75781 125.18398-39.671874 126.426169-39.226562C125.18398-38.777343 123.95351-37.69141 123.39883-35.39453"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M99.8747-25.0508H183.7187 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M102.30468-21.21875C101.74999-23.51953 100.51953-24.605465 99.277338-25.050777C100.51953-25.499996 101.74999-26.58203 102.30468-28.88281"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M156.5667-10.8789H240.4137 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M159.00008-7.04689C158.44539-9.34377 157.21101-10.429704 155.968825-10.878922C157.21101-11.324235 158.44539-12.41017 159.00008-14.70705"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 149.0374 71.44817)"><use x=-71.402255 xlink:href=#g0-58 y=-67.571482 /><use x=-66.158096 xlink:href=#g0-58 y=-67.571482 /><use x=-60.913937 xlink:href=#g0-58 y=-67.571482 /></g></g><title>A couple of "chained" arrows, each one both starting after the previous one but also ending after the previous one. The first few chained arrows all point forward, and the rest point backward. Some other arrows may also be present.</title></svg></div><div class="diagram only-dark"><svg viewbox="-72.000111 -72.000105 313.011576 75.876793"height=75.876793pt version=1.1 width=313.011576pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M2.199751-.573848C2.199751-.920548 1.912827-1.159651 1.625903-1.159651C1.279203-1.159651 1.0401-.872727 1.0401-.585803C1.0401-.239103 1.327024 0 1.613948 0C1.960648 0 2.199751-.286924 2.199751-.573848Z"id=g0-58 /></defs><g id=page1><path d=M-71.402346-67.57031H12.4414 fill=none stroke=#e64d80 stroke-width=1.19553 /><path d="M10.01176-71.40234C10.56645-69.10547 11.79692-68.019529 13.039103-67.57031C11.79692-67.124997 10.56645-66.03906 10.01176-63.74218"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-53.3984H69.1367 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-57.23046C67.25782-54.92967 68.49219-53.843737 69.734381-53.398424C68.49219-52.953112 67.25782-51.86717 66.70704-49.56639"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-39.2266H125.8277 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-43.05469C123.95351-40.75781 125.18398-39.671874 126.426169-39.226562C125.18398-38.777343 123.95351-37.69141 123.39883-35.39453"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M99.8747-25.0508H183.7187 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M102.30468-21.21875C101.74999-23.51953 100.51953-24.605465 99.277338-25.050777C100.51953-25.499996 101.74999-26.58203 102.30468-28.88281"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M156.5667-10.8789H240.4137 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M159.00008-7.04689C158.44539-9.34377 157.21101-10.429704 155.968825-10.878922C157.21101-11.324235 158.44539-12.41017 159.00008-14.70705"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 149.0374 71.44817)"fill=#fff><use x=-71.402255 xlink:href=#g0-58 y=-67.571482 /><use x=-66.158096 xlink:href=#g0-58 y=-67.571482 /><use x=-60.913937 xlink:href=#g0-58 y=-67.571482 /></g></g><title>A couple of "chained" arrows, each one both starting after the previous one but also ending after the previous one. The first few chained arrows all point forward, and the rest point backward. Some other arrows may also be present.</title></svg></div><p>The core of the problem is the <em>head-to-head</em> collision. It closely resembles irreducible control flow from the CFG world. Ramshaw’s paper proves that such conflicts cannot be resolved with <code>break</code>, <code>continue</code>, and blocks alone: no tail extension can make such arrows nest, but head extensions are impossible because they change the target of the jump… or are they?<p>There’s a non-zero-cost approach to this: we can introduce a <em>dispatcher</em> at the start of the block, extend the backward arrow’s head to point to the dispatcher, and then add an arrow from the dispatcher to the original head:<div class="diagram only-light"><svg viewbox="-72.000111 -72.000105 483.089576 54.21119"height=54.21119pt version=1.1 width=483.089576pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M3.347447-.765131C2.785554-.765131 2.355168-.956413 2.056289-1.350934S1.613948-2.307347 1.613948-3.036613V-3.239851C1.613948-3.981071 1.75741-4.554919 2.068244-4.94944C2.367123-5.34396 2.797509-5.547198 3.347447-5.547198C3.753923-5.547198 4.088667-5.415691 4.375592-5.152677C4.65056-4.889664 4.805978-4.554919 4.841843-4.148443H5.858032C5.822167-4.817933 5.571108-5.36787 5.104857-5.798257C4.638605-6.216687 4.052802-6.43188 3.347447-6.43188C2.773599-6.43188 2.271482-6.300374 1.853051-6.03736C1.422665-5.774346 1.099875-5.391781 .872727-4.913574S.537983-3.88543 .537983-3.275716V-3.096389C.537983-2.092154 .789041-1.315068 1.291158-.74122S2.486675 .119552 3.347447 .119552C3.777833 .119552 4.184309 .02391 4.566874-.167372S5.248319-.621669 5.487422-.956413C5.71457-1.291158 5.834122-1.637858 5.858032-1.996513H4.841843C4.805978-1.637858 4.638605-1.350934 4.351681-1.111831S3.730012-.765131 3.347447-.765131Z"id=g0-99 /><path d="M.549938-3.21594V-3.132254C.549938-2.163885 .777086-1.374844 1.243337-.777086C1.697634-.179328 2.295392 .119552 3.036613 .119552C3.801743 .119552 4.411457-.155417 4.841843-.681445L4.889664 0H5.881943V-8.966376H4.805978V-5.678705C4.375592-6.180822 3.789788-6.43188 3.048568-6.43188S1.697634-6.133001 1.243337-5.547198C.777086-4.961395 .549938-4.184309 .549938-3.21594ZM1.637858-3.084433C1.637858-3.88543 1.78132-4.495143 2.080199-4.901619C2.367123-5.308095 2.785554-5.511333 3.311582-5.511333C3.981071-5.511333 4.471233-5.224408 4.805978-4.62665V-1.721544C4.483188-1.099875 3.981071-.800996 3.299626-.800996C2.773599-.800996 2.367123-.992279 2.080199-1.398755C1.78132-1.80523 1.637858-2.367123 1.637858-3.084433Z"id=g0-100 /><path d="M3.443088 .119552C4.495143 .119552 5.296139-.286924 5.822167-1.099875L5.164633-1.613948C4.961395-1.350934 4.722291-1.147696 4.459278-.992279S3.873474-.765131 3.490909-.765131C2.952927-.765131 2.510585-.956413 2.163885-1.338979S1.637858-2.223661 1.625903-2.84533H5.905853V-3.299626C5.905853-4.303861 5.66675-5.068991 5.212453-5.618929C4.758157-6.156912 4.112578-6.43188 3.299626-6.43188C2.797509-6.43188 2.331258-6.288418 1.900872-6.01345C1.470486-5.726526 1.135741-5.34396 .896638-4.853798S.537983-3.801743 .537983-3.180075V-2.988792C.537983-2.032379 .800996-1.279203 1.350934-.71731C1.888917-.155417 2.582316 .119552 3.443088 .119552ZM3.299626-5.547198C3.753923-5.547198 4.112578-5.391781 4.375592-5.092902C4.638605-4.782067 4.782067-4.363636 4.817933-3.813699V-3.730012H1.661768C1.721544-4.303861 1.900872-4.746202 2.199751-5.068991C2.486675-5.379826 2.857285-5.547198 3.299626-5.547198Z"id=g0-101 /><path d="M1.900872-5.547198V-8.966376H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C3.000747-6.43188 2.379078-6.133001 1.900872-5.547198Z"id=g0-104 /><path d="M1.996513 0V-6.312329H.908593V0H1.996513ZM.824907-7.986052C.824907-7.806725 .872727-7.663263 .980324-7.543711S1.243337-7.376339 1.458531-7.376339C1.661768-7.376339 1.817186-7.424159 1.936737-7.543711C2.044334-7.663263 2.10411-7.806725 2.10411-7.986052C2.10411-8.153425 2.044334-8.308842 1.936737-8.428394C1.817186-8.547945 1.661768-8.619676 1.458531-8.619676C1.243337-8.619676 1.08792-8.547945 .980324-8.428394S.824907-8.153425 .824907-7.986052Z"id=g0-105 /><path d="M1.936737-6.312329H.848817V.753176C.848817 1.08792 .777086 1.315068 .657534 1.43462C.526027 1.566127 .3467 1.625903 .107597 1.625903C-.095641 1.625903-.263014 1.613948-.382565 1.578082V2.450809C-.191283 2.52254 .035866 2.546451 .274969 2.546451C1.374844 2.546451 1.936737 1.948692 1.936737 .729265V-6.312329ZM.74122-7.986052C.74122-7.806725 .789041-7.663263 .896638-7.543711C.992279-7.424159 1.147696-7.376339 1.362889-7.376339S1.733499-7.424159 1.841096-7.543711S2.008468-7.806725 2.008468-7.986052C2.008468-8.153425 1.948692-8.308842 1.841096-8.428394S1.578082-8.619676 1.374844-8.619676C1.159651-8.619676 1.004234-8.547945 .896638-8.428394C.789041-8.296887 .74122-8.153425 .74122-7.986052Z"id=g0-106 /><path d="M1.829141-6.312329H.812951V0H1.888917V-4.614695C2.15193-5.212453 2.630137-5.511333 3.347447-5.511333C4.244085-5.511333 4.698381-5.045081 4.698381-4.136488V0H5.774346V-4.196264C5.822167-4.590785 5.977584-4.913574 6.240598-5.152677S6.826401-5.511333 7.232877-5.511333C7.723039-5.511333 8.069738-5.391781 8.272976-5.176588S8.583811-4.62665 8.583811-4.172354V0H9.671731V-4.23213C9.647821-5.69066 8.942466-6.43188 7.555666-6.43188C7.089415-6.43188 6.682939-6.336239 6.348194-6.144956S5.738481-5.71457 5.535243-5.415691C5.212453-6.085181 4.614695-6.43188 3.730012-6.43188C2.940971-6.43188 2.319303-6.156912 1.865006-5.618929L1.829141-6.312329Z"id=g0-109 /><path d="M.526027-3.21594V-3.144209C.526027-2.163885 .789041-1.374844 1.327024-.777086C1.853051-.179328 2.546451 .119552 3.407223 .119552C3.969116 .119552 4.471233-.011955 4.913574-.286924C5.34396-.561893 5.678705-.944458 5.917808-1.43462C6.156912-1.912827 6.276463-2.462765 6.276463-3.084433V-3.16812C6.276463-4.148443 6.001494-4.937484 5.475467-5.535243S4.25604-6.43188 3.395268-6.43188C2.833375-6.43188 2.331258-6.288418 1.900872-6.025405S1.123786-5.379826 .884682-4.889664C.645579-4.387547 .526027-3.837609 .526027-3.21594ZM1.613948-3.084433C1.613948-3.873474 1.769365-4.471233 2.10411-4.901619C2.426899-5.332005 2.857285-5.547198 3.395268-5.547198C3.945205-5.547198 4.375592-5.332005 4.710336-4.901619C5.033126-4.471233 5.200498-3.90934 5.200498-3.21594C5.200498-2.438854 5.033126-1.841096 4.710336-1.41071S3.957161-.765131 3.407223-.765131S2.426899-.968369 2.10411-1.398755C1.769365-1.817186 1.613948-2.379078 1.613948-3.084433Z"id=g0-111 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /><path d="M3.873474-5.34396V-6.348194C3.753923-6.396015 3.598506-6.43188 3.395268-6.43188C2.737733-6.43188 2.235616-6.144956 1.888917-5.583064L1.865006-6.312329H.812951V0H1.900872V-4.483188C2.139975-5.080946 2.618182-5.391781 3.335492-5.391781C3.526775-5.379826 3.706102-5.36787 3.873474-5.34396Z"id=g0-114 /><path d="M4.495143-1.673724C4.495143-1.3868 4.363636-1.171606 4.124533-1.004234C3.873474-.836862 3.550685-.765131 3.144209-.765131C2.689913-.765131 2.331258-.872727 2.068244-1.08792C1.793275-1.303113 1.649813-1.590037 1.637858-1.948692H.549938C.549938-1.566127 .657534-1.219427 .884682-.896638C1.099875-.573848 1.41071-.32279 1.80523-.143462C2.187796 .035866 2.642092 .119552 3.144209 .119552C3.861519 .119552 4.435367-.047821 4.889664-.382565S5.571108-1.171606 5.571108-1.745455C5.571108-2.080199 5.487422-2.367123 5.332005-2.606227C5.164633-2.84533 4.925529-3.048568 4.590785-3.21594S3.813699-3.526775 3.275716-3.646326S2.367123-3.88543 2.163885-4.016936C1.948692-4.148443 1.853051-4.351681 1.853051-4.614695C1.853051-4.889664 1.960648-5.116812 2.187796-5.284184C2.402989-5.451557 2.713823-5.547198 3.108344-5.547198C3.490909-5.547198 3.801743-5.439601 4.052802-5.224408S4.435367-4.746202 4.435367-4.459278H5.511333C5.511333-5.033126 5.284184-5.499377 4.841843-5.869988S3.825654-6.43188 3.108344-6.43188C2.414944-6.43188 1.853051-6.252553 1.422665-5.893898C.980324-5.535243 .765131-5.092902 .765131-4.578829C.765131-4.267995 .836862-3.993026 .992279-3.777833C1.147696-3.550685 1.3868-3.359402 1.709589-3.19203S2.462765-2.893151 3.012702-2.773599S3.945205-2.510585 4.160399-2.355168C4.375592-2.187796 4.495143-1.960648 4.495143-1.673724Z"id=g0-115 /><path d="M2.283437-7.84259H1.207472V-6.312329H.047821V-5.475467H1.207472V-1.566127C1.207472-1.016189 1.327024-.597758 1.566127-.310834S2.175841 .119552 2.666002 .119552C2.929016 .119552 3.203985 .083686 3.490909 0V-.872727C3.275716-.824907 3.096389-.800996 2.976837-.800996C2.713823-.800996 2.534496-.860772 2.438854-.992279C2.331258-1.111831 2.283437-1.303113 2.283437-1.566127V-5.475467H3.466999V-6.312329H2.283437V-7.84259Z"id=g0-116 /><path d="M4.722291-.621669L4.734247 0H5.762391V-6.312329H4.686426V-1.721544C4.411457-1.099875 3.861519-.800996 3.036613-.800996C2.259527-.800996 1.876961-1.279203 1.876961-2.235616V-6.312329H.789041V-2.211706C.789041-1.43462 .968369-.848817 1.327024-.466252C1.685679-.071731 2.199751 .119552 2.86924 .119552C3.682192 .119552 4.291905-.119552 4.722291-.621669Z"id=g0-117 /><path d="M17.995401-8.105366C19.036457-7.213033 20.300597-6.568569 21.11857-6.196763C20.226236-5.800171 19.01167-5.155707 17.995401-4.28816H2.255622C1.834242-4.28816 1.363288-4.28816 1.363288-3.792419S1.809455-3.296678 2.230835-3.296678H16.879983C15.690205-2.156474 14.401278 .024787 14.401278 .347019C14.401278 .619676 14.72351 .619676 14.872232 .619676C15.070528 .619676 15.244038 .619676 15.343186 .42138C15.863714-.520528 16.557752-1.834242 18.16891-3.271891C19.879217-4.783901 21.539949-5.453152 22.828876-5.824958C23.250256-5.97368 23.275043-5.998467 23.324617-6.048041C23.374191-6.072828 23.374191-6.147189 23.374191-6.196763S23.374191-6.295912 23.349404-6.345486L23.275043-6.39506C23.225469-6.419847 23.200682-6.444634 22.729728-6.593356C19.383476-7.584838 16.90477-9.84046 15.516695-12.492675C15.244038-12.988416 15.219251-13.013203 14.872232-13.013203C14.72351-13.013203 14.401278-13.013203 14.401278-12.740545C14.401278-12.418314 15.665418-10.26184 16.879983-9.096849H2.230835C1.809455-9.096849 1.363288-9.096849 1.363288-8.601108S1.834242-8.105366 2.255622-8.105366H17.995401Z"id=g1-41 /></defs><g id=page1><path d=M-71.402346-67.57031H69.1367 fill=none stroke=#f33 stroke-width=1.19553 /><path d="M66.70704-71.40234C67.25782-69.10547 68.49219-68.019529 69.734381-67.57031C68.49219-67.124997 67.25782-66.03906 66.70704-63.74218"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-13.5117-44.8945H127.0237 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d=M-11.082-41.06252C-11.63669-43.3633-12.86716-44.445331-14.109347-44.894549C-12.86716-45.339862-11.63669-46.4258-11.082-48.72658 fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 228.5543 27.2244)"><use x=-71.402255 xlink:href=#g1-41 y=-67.571482 /></g><path d=M212.0667-67.57031H352.6057 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M350.17179-71.40234C350.72648-69.10547 351.96085-68.019529 353.203038-67.57031C351.96085-67.124997 350.72648-66.03906 350.17179-63.74218"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-44.8945H410.4917 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-41.06252C215.1411-43.3633 213.90672-44.445331 212.664534-44.894549C213.90672-45.339862 215.1411-46.4258 215.69188-48.72658"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 333.0913 16.2127)"><use x=-71.402255 xlink:href=#g0-106 y=-67.571482 /><use x=-68.556926 xlink:href=#g0-117 y=-67.571482 /><use x=-61.969633 xlink:href=#g0-109 y=-67.571482 /><use x=-51.496901 xlink:href=#g0-112 y=-67.571482 /><use x=-41.837137 xlink:href=#g0-116 y=-67.571482 /><use x=-38.059312 xlink:href=#g0-111 y=-67.571482 /><use x=-28.291954 xlink:href=#g0-100 y=-67.571482 /><use x=-21.561197 xlink:href=#g0-105 y=-67.571482 /><use x=-18.668051 xlink:href=#g0-115 y=-67.571482 /><use x=-12.511135 xlink:href=#g0-112 y=-67.571482 /><use x=-5.804288 xlink:href=#g0-97 y=-67.571482 /><use x=.687371 xlink:href=#g0-116 y=-67.571482 /><use x=4.584759 xlink:href=#g0-99 y=-67.571482 /><use x=10.837309 xlink:href=#g0-104 y=-67.571482 /><use x=17.412654 xlink:href=#g0-101 y=-67.571482 /><use x=23.736941 xlink:href=#g0-114 y=-67.571482 /></g><path d=M212.0667-22.2148H267.5627 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-26.04683C265.68782-23.74996 266.91829-22.66402 268.160474-22.214802C266.91829-21.769489 265.68782-20.68355 265.13313-18.38668"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 288.9623 39.0098)"><use x=-71.402255 xlink:href=#g0-100 y=-67.571482 /><use x=-64.671499 xlink:href=#g0-105 y=-67.571482 /><use x=-61.778352 xlink:href=#g0-115 y=-67.571482 /><use x=-55.621437 xlink:href=#g0-112 y=-67.571482 /><use x=-48.914589 xlink:href=#g0-97 y=-67.571482 /><use x=-42.42293 xlink:href=#g0-116 y=-67.571482 /><use x=-38.525543 xlink:href=#g0-99 y=-67.571482 /><use x=-32.272993 xlink:href=#g0-104 y=-67.571482 /></g></g><title>We start with a simple head-to-head collision. The forward arrow stays as is, while the backward arrow's head is extended to the very left such that the arrows now correctly nest. The new backward arrow is named "jump to dispatcher". A new arrow, called "dispatch", appears, starting at the leftmost position and continuing to the right to where the head of the backward arrow was.</title></svg></div><div class="diagram only-dark"><svg viewbox="-72.000111 -72.000105 483.089576 54.21119"height=54.21119pt version=1.1 width=483.089576pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M3.347447-.765131C2.785554-.765131 2.355168-.956413 2.056289-1.350934S1.613948-2.307347 1.613948-3.036613V-3.239851C1.613948-3.981071 1.75741-4.554919 2.068244-4.94944C2.367123-5.34396 2.797509-5.547198 3.347447-5.547198C3.753923-5.547198 4.088667-5.415691 4.375592-5.152677C4.65056-4.889664 4.805978-4.554919 4.841843-4.148443H5.858032C5.822167-4.817933 5.571108-5.36787 5.104857-5.798257C4.638605-6.216687 4.052802-6.43188 3.347447-6.43188C2.773599-6.43188 2.271482-6.300374 1.853051-6.03736C1.422665-5.774346 1.099875-5.391781 .872727-4.913574S.537983-3.88543 .537983-3.275716V-3.096389C.537983-2.092154 .789041-1.315068 1.291158-.74122S2.486675 .119552 3.347447 .119552C3.777833 .119552 4.184309 .02391 4.566874-.167372S5.248319-.621669 5.487422-.956413C5.71457-1.291158 5.834122-1.637858 5.858032-1.996513H4.841843C4.805978-1.637858 4.638605-1.350934 4.351681-1.111831S3.730012-.765131 3.347447-.765131Z"id=g0-99 /><path d="M.549938-3.21594V-3.132254C.549938-2.163885 .777086-1.374844 1.243337-.777086C1.697634-.179328 2.295392 .119552 3.036613 .119552C3.801743 .119552 4.411457-.155417 4.841843-.681445L4.889664 0H5.881943V-8.966376H4.805978V-5.678705C4.375592-6.180822 3.789788-6.43188 3.048568-6.43188S1.697634-6.133001 1.243337-5.547198C.777086-4.961395 .549938-4.184309 .549938-3.21594ZM1.637858-3.084433C1.637858-3.88543 1.78132-4.495143 2.080199-4.901619C2.367123-5.308095 2.785554-5.511333 3.311582-5.511333C3.981071-5.511333 4.471233-5.224408 4.805978-4.62665V-1.721544C4.483188-1.099875 3.981071-.800996 3.299626-.800996C2.773599-.800996 2.367123-.992279 2.080199-1.398755C1.78132-1.80523 1.637858-2.367123 1.637858-3.084433Z"id=g0-100 /><path d="M3.443088 .119552C4.495143 .119552 5.296139-.286924 5.822167-1.099875L5.164633-1.613948C4.961395-1.350934 4.722291-1.147696 4.459278-.992279S3.873474-.765131 3.490909-.765131C2.952927-.765131 2.510585-.956413 2.163885-1.338979S1.637858-2.223661 1.625903-2.84533H5.905853V-3.299626C5.905853-4.303861 5.66675-5.068991 5.212453-5.618929C4.758157-6.156912 4.112578-6.43188 3.299626-6.43188C2.797509-6.43188 2.331258-6.288418 1.900872-6.01345C1.470486-5.726526 1.135741-5.34396 .896638-4.853798S.537983-3.801743 .537983-3.180075V-2.988792C.537983-2.032379 .800996-1.279203 1.350934-.71731C1.888917-.155417 2.582316 .119552 3.443088 .119552ZM3.299626-5.547198C3.753923-5.547198 4.112578-5.391781 4.375592-5.092902C4.638605-4.782067 4.782067-4.363636 4.817933-3.813699V-3.730012H1.661768C1.721544-4.303861 1.900872-4.746202 2.199751-5.068991C2.486675-5.379826 2.857285-5.547198 3.299626-5.547198Z"id=g0-101 /><path d="M1.900872-5.547198V-8.966376H.812951V0H1.900872V-4.495143C2.044334-4.805978 2.247572-5.045081 2.510585-5.236364C2.773599-5.415691 3.084433-5.511333 3.443088-5.511333C3.873474-5.511333 4.184309-5.403736 4.399502-5.188543C4.60274-4.97335 4.710336-4.638605 4.710336-4.184309V0H5.786301V-4.172354C5.762391-5.678705 5.092902-6.43188 3.765878-6.43188C3.000747-6.43188 2.379078-6.133001 1.900872-5.547198Z"id=g0-104 /><path d="M1.996513 0V-6.312329H.908593V0H1.996513ZM.824907-7.986052C.824907-7.806725 .872727-7.663263 .980324-7.543711S1.243337-7.376339 1.458531-7.376339C1.661768-7.376339 1.817186-7.424159 1.936737-7.543711C2.044334-7.663263 2.10411-7.806725 2.10411-7.986052C2.10411-8.153425 2.044334-8.308842 1.936737-8.428394C1.817186-8.547945 1.661768-8.619676 1.458531-8.619676C1.243337-8.619676 1.08792-8.547945 .980324-8.428394S.824907-8.153425 .824907-7.986052Z"id=g0-105 /><path d="M1.936737-6.312329H.848817V.753176C.848817 1.08792 .777086 1.315068 .657534 1.43462C.526027 1.566127 .3467 1.625903 .107597 1.625903C-.095641 1.625903-.263014 1.613948-.382565 1.578082V2.450809C-.191283 2.52254 .035866 2.546451 .274969 2.546451C1.374844 2.546451 1.936737 1.948692 1.936737 .729265V-6.312329ZM.74122-7.986052C.74122-7.806725 .789041-7.663263 .896638-7.543711C.992279-7.424159 1.147696-7.376339 1.362889-7.376339S1.733499-7.424159 1.841096-7.543711S2.008468-7.806725 2.008468-7.986052C2.008468-8.153425 1.948692-8.308842 1.841096-8.428394S1.578082-8.619676 1.374844-8.619676C1.159651-8.619676 1.004234-8.547945 .896638-8.428394C.789041-8.296887 .74122-8.153425 .74122-7.986052Z"id=g0-106 /><path d="M1.829141-6.312329H.812951V0H1.888917V-4.614695C2.15193-5.212453 2.630137-5.511333 3.347447-5.511333C4.244085-5.511333 4.698381-5.045081 4.698381-4.136488V0H5.774346V-4.196264C5.822167-4.590785 5.977584-4.913574 6.240598-5.152677S6.826401-5.511333 7.232877-5.511333C7.723039-5.511333 8.069738-5.391781 8.272976-5.176588S8.583811-4.62665 8.583811-4.172354V0H9.671731V-4.23213C9.647821-5.69066 8.942466-6.43188 7.555666-6.43188C7.089415-6.43188 6.682939-6.336239 6.348194-6.144956S5.738481-5.71457 5.535243-5.415691C5.212453-6.085181 4.614695-6.43188 3.730012-6.43188C2.940971-6.43188 2.319303-6.156912 1.865006-5.618929L1.829141-6.312329Z"id=g0-109 /><path d="M.526027-3.21594V-3.144209C.526027-2.163885 .789041-1.374844 1.327024-.777086C1.853051-.179328 2.546451 .119552 3.407223 .119552C3.969116 .119552 4.471233-.011955 4.913574-.286924C5.34396-.561893 5.678705-.944458 5.917808-1.43462C6.156912-1.912827 6.276463-2.462765 6.276463-3.084433V-3.16812C6.276463-4.148443 6.001494-4.937484 5.475467-5.535243S4.25604-6.43188 3.395268-6.43188C2.833375-6.43188 2.331258-6.288418 1.900872-6.025405S1.123786-5.379826 .884682-4.889664C.645579-4.387547 .526027-3.837609 .526027-3.21594ZM1.613948-3.084433C1.613948-3.873474 1.769365-4.471233 2.10411-4.901619C2.426899-5.332005 2.857285-5.547198 3.395268-5.547198C3.945205-5.547198 4.375592-5.332005 4.710336-4.901619C5.033126-4.471233 5.200498-3.90934 5.200498-3.21594C5.200498-2.438854 5.033126-1.841096 4.710336-1.41071S3.957161-.765131 3.407223-.765131S2.426899-.968369 2.10411-1.398755C1.769365-1.817186 1.613948-2.379078 1.613948-3.084433Z"id=g0-111 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /><path d="M3.873474-5.34396V-6.348194C3.753923-6.396015 3.598506-6.43188 3.395268-6.43188C2.737733-6.43188 2.235616-6.144956 1.888917-5.583064L1.865006-6.312329H.812951V0H1.900872V-4.483188C2.139975-5.080946 2.618182-5.391781 3.335492-5.391781C3.526775-5.379826 3.706102-5.36787 3.873474-5.34396Z"id=g0-114 /><path d="M4.495143-1.673724C4.495143-1.3868 4.363636-1.171606 4.124533-1.004234C3.873474-.836862 3.550685-.765131 3.144209-.765131C2.689913-.765131 2.331258-.872727 2.068244-1.08792C1.793275-1.303113 1.649813-1.590037 1.637858-1.948692H.549938C.549938-1.566127 .657534-1.219427 .884682-.896638C1.099875-.573848 1.41071-.32279 1.80523-.143462C2.187796 .035866 2.642092 .119552 3.144209 .119552C3.861519 .119552 4.435367-.047821 4.889664-.382565S5.571108-1.171606 5.571108-1.745455C5.571108-2.080199 5.487422-2.367123 5.332005-2.606227C5.164633-2.84533 4.925529-3.048568 4.590785-3.21594S3.813699-3.526775 3.275716-3.646326S2.367123-3.88543 2.163885-4.016936C1.948692-4.148443 1.853051-4.351681 1.853051-4.614695C1.853051-4.889664 1.960648-5.116812 2.187796-5.284184C2.402989-5.451557 2.713823-5.547198 3.108344-5.547198C3.490909-5.547198 3.801743-5.439601 4.052802-5.224408S4.435367-4.746202 4.435367-4.459278H5.511333C5.511333-5.033126 5.284184-5.499377 4.841843-5.869988S3.825654-6.43188 3.108344-6.43188C2.414944-6.43188 1.853051-6.252553 1.422665-5.893898C.980324-5.535243 .765131-5.092902 .765131-4.578829C.765131-4.267995 .836862-3.993026 .992279-3.777833C1.147696-3.550685 1.3868-3.359402 1.709589-3.19203S2.462765-2.893151 3.012702-2.773599S3.945205-2.510585 4.160399-2.355168C4.375592-2.187796 4.495143-1.960648 4.495143-1.673724Z"id=g0-115 /><path d="M2.283437-7.84259H1.207472V-6.312329H.047821V-5.475467H1.207472V-1.566127C1.207472-1.016189 1.327024-.597758 1.566127-.310834S2.175841 .119552 2.666002 .119552C2.929016 .119552 3.203985 .083686 3.490909 0V-.872727C3.275716-.824907 3.096389-.800996 2.976837-.800996C2.713823-.800996 2.534496-.860772 2.438854-.992279C2.331258-1.111831 2.283437-1.303113 2.283437-1.566127V-5.475467H3.466999V-6.312329H2.283437V-7.84259Z"id=g0-116 /><path d="M4.722291-.621669L4.734247 0H5.762391V-6.312329H4.686426V-1.721544C4.411457-1.099875 3.861519-.800996 3.036613-.800996C2.259527-.800996 1.876961-1.279203 1.876961-2.235616V-6.312329H.789041V-2.211706C.789041-1.43462 .968369-.848817 1.327024-.466252C1.685679-.071731 2.199751 .119552 2.86924 .119552C3.682192 .119552 4.291905-.119552 4.722291-.621669Z"id=g0-117 /><path d="M17.995401-8.105366C19.036457-7.213033 20.300597-6.568569 21.11857-6.196763C20.226236-5.800171 19.01167-5.155707 17.995401-4.28816H2.255622C1.834242-4.28816 1.363288-4.28816 1.363288-3.792419S1.809455-3.296678 2.230835-3.296678H16.879983C15.690205-2.156474 14.401278 .024787 14.401278 .347019C14.401278 .619676 14.72351 .619676 14.872232 .619676C15.070528 .619676 15.244038 .619676 15.343186 .42138C15.863714-.520528 16.557752-1.834242 18.16891-3.271891C19.879217-4.783901 21.539949-5.453152 22.828876-5.824958C23.250256-5.97368 23.275043-5.998467 23.324617-6.048041C23.374191-6.072828 23.374191-6.147189 23.374191-6.196763S23.374191-6.295912 23.349404-6.345486L23.275043-6.39506C23.225469-6.419847 23.200682-6.444634 22.729728-6.593356C19.383476-7.584838 16.90477-9.84046 15.516695-12.492675C15.244038-12.988416 15.219251-13.013203 14.872232-13.013203C14.72351-13.013203 14.401278-13.013203 14.401278-12.740545C14.401278-12.418314 15.665418-10.26184 16.879983-9.096849H2.230835C1.809455-9.096849 1.363288-9.096849 1.363288-8.601108S1.834242-8.105366 2.255622-8.105366H17.995401Z"id=g1-41 /></defs><g id=page1><path d=M-71.402346-67.57031H69.1367 fill=none stroke=#e64d80 stroke-width=1.19553 /><path d="M66.70704-71.40234C67.25782-69.10547 68.49219-68.019529 69.734381-67.57031C68.49219-67.124997 67.25782-66.03906 66.70704-63.74218"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-13.5117-44.8945H127.0237 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d=M-11.082-41.06252C-11.63669-43.3633-12.86716-44.445331-14.109347-44.894549C-12.86716-45.339862-11.63669-46.4258-11.082-48.72658 fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 228.5543 27.2244)"fill=#fff><use x=-71.402255 xlink:href=#g1-41 y=-67.571482 /></g><path d=M212.0667-67.57031H352.6057 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M350.17179-71.40234C350.72648-69.10547 351.96085-68.019529 353.203038-67.57031C351.96085-67.124997 350.72648-66.03906 350.17179-63.74218"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-44.8945H410.4917 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-41.06252C215.1411-43.3633 213.90672-44.445331 212.664534-44.894549C213.90672-45.339862 215.1411-46.4258 215.69188-48.72658"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 333.0913 16.2127)"fill=#fff><use x=-71.402255 xlink:href=#g0-106 y=-67.571482 /><use x=-68.556926 xlink:href=#g0-117 y=-67.571482 /><use x=-61.969633 xlink:href=#g0-109 y=-67.571482 /><use x=-51.496901 xlink:href=#g0-112 y=-67.571482 /><use x=-41.837137 xlink:href=#g0-116 y=-67.571482 /><use x=-38.059312 xlink:href=#g0-111 y=-67.571482 /><use x=-28.291954 xlink:href=#g0-100 y=-67.571482 /><use x=-21.561197 xlink:href=#g0-105 y=-67.571482 /><use x=-18.668051 xlink:href=#g0-115 y=-67.571482 /><use x=-12.511135 xlink:href=#g0-112 y=-67.571482 /><use x=-5.804288 xlink:href=#g0-97 y=-67.571482 /><use x=.687371 xlink:href=#g0-116 y=-67.571482 /><use x=4.584759 xlink:href=#g0-99 y=-67.571482 /><use x=10.837309 xlink:href=#g0-104 y=-67.571482 /><use x=17.412654 xlink:href=#g0-101 y=-67.571482 /><use x=23.736941 xlink:href=#g0-114 y=-67.571482 /></g><path d=M212.0667-22.2148H267.5627 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-26.04683C265.68782-23.74996 266.91829-22.66402 268.160474-22.214802C266.91829-21.769489 265.68782-20.68355 265.13313-18.38668"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 288.9623 39.0098)"fill=#fff><use x=-71.402255 xlink:href=#g0-100 y=-67.571482 /><use x=-64.671499 xlink:href=#g0-105 y=-67.571482 /><use x=-61.778352 xlink:href=#g0-115 y=-67.571482 /><use x=-55.621437 xlink:href=#g0-112 y=-67.571482 /><use x=-48.914589 xlink:href=#g0-97 y=-67.571482 /><use x=-42.42293 xlink:href=#g0-116 y=-67.571482 /><use x=-38.525543 xlink:href=#g0-99 y=-67.571482 /><use x=-32.272993 xlink:href=#g0-104 y=-67.571482 /></g></g><title>We start with a simple head-to-head collision. The forward arrow stays as is, while the backward arrow's head is extended to the very left such that the arrows now correctly nest. The new backward arrow is named "jump to dispatcher". A new arrow, called "dispatch", appears, starting at the leftmost position and continuing to the right to where the head of the backward arrow was.</title></svg></div><p>The “jump to dispatcher” arrow sets a synthetic variable and emits <code>continue</code>. The dispatcher, which is a synthetic statement inserted at <eq><math><mi>l</mi></math></eq>, reads the synthetic variable and, if it’s set, uses <code>break</code> to jump to the target location. For example,<pre><code class=language-c>    <span class=hljs-keyword>if</span> (cond) <span class=hljs-keyword>goto</span> b;
a:  f();
b:  g();
    <span class=hljs-keyword>goto</span> a;
</code></pre><p>…can be decompiled as:<pre><code class=language-java><span class=hljs-type>Target</span> <span class=hljs-variable>target</span> <span class=hljs-operator>=</span> Target.Fallthrough;
<span class=hljs-keyword>while</span> (<span class=hljs-literal>true</span>) {
    <span class=hljs-keyword>switch</span> (target) {
    <span class=hljs-keyword>case</span> Target.A:
        target = Target.Fallthrough;
        <span class=hljs-keyword>break</span>;
    <span class=hljs-keyword>case</span> Target.Fallthrough:
        <span class=hljs-keyword>if</span> (!cond) {
            f();
        }
    }
    g();
    target = Target.A;
}
</code></pre><p>…and while it’s somewhat ugly, a trivial dispatcher is at least a viable starting point. When you think about it, it’s similar to how people implement finite automata in high-level languages: with a variable for the current state, <code>switch</code> over the state inside <code>while (true)</code>, and changing states implemented by modifying the variable and restarting the <code>switch</code>. Certain decompilers handle methods with irreducible control flow like this <em>globally</em>, but this approach allows us to localize the impact to the exact block that causes trouble.<p><em>Anyway</em>, the main point here is that there’s a simple way to fix this in terms of arrows. Find the first split gap inside <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> <em>while ignoring all backward arrows</em>. Such a gap always exists, and is only an invalid gap due to all the backward arrows crossing it:<div class="diagram only-light"><svg viewbox="-72.000111 -68.679719 340.75835 112.613384"height=112.613384pt version=1.1 width=340.75835pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M.561893-3.21594C.561893-2.187796 .789041-1.374844 1.243337-.777086S2.295392 .119552 3.036613 .119552S4.375592-.131507 4.805978-.633624V-.083686C4.805978 .454296 4.65056 .872727 4.363636 1.159651C4.076712 1.458531 3.670237 1.601993 3.144209 1.601993C2.47472 1.601993 1.900872 1.315068 1.446575 .74122L.884682 1.398755C1.111831 1.733499 1.446575 2.008468 1.876961 2.199751S2.761644 2.486675 3.21594 2.486675C4.028892 2.486675 4.686426 2.259527 5.164633 1.78132C5.642839 1.315068 5.893898 .669489 5.893898-.155417V-6.312329H4.913574L4.853798-5.618929C4.423412-6.156912 3.813699-6.43188 3.048568-6.43188C2.295392-6.43188 1.697634-6.133001 1.243337-5.559153S.561893-4.196264 .561893-3.21594ZM1.649813-3.084433C1.649813-3.88543 1.793275-4.495143 2.092154-4.901619C2.379078-5.308095 2.797509-5.511333 3.323537-5.511333C3.969116-5.511333 4.471233-5.212453 4.805978-4.614695V-1.733499C4.483188-1.111831 3.981071-.800996 3.311582-.800996C2.785554-.800996 2.367123-1.004234 2.080199-1.41071S1.649813-2.367123 1.649813-3.084433Z"id=g0-103 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /></defs><g id=page1><path d=M-71.402346-41.707032H12.4414 fill=none stroke=#f33 stroke-width=1.19553 /><path d="M10.01176-45.53516C10.56645-43.23828 11.79692-42.152344 13.039103-41.707032C11.79692-41.257813 10.56645-40.17188 10.01176-37.875"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-27.5313H69.1367 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-31.36327C67.25782-29.06249 68.49219-27.980459 69.734381-27.53124C68.49219-27.085928 67.25782-25.99999 66.70704-23.69921"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-13.3594H125.8277 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-17.1875C123.95351-14.89063 125.18398-13.804688 126.426169-13.359375C125.18398-12.910157 123.95351-11.82813 123.39883-9.52734"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M99.8747 .8164H212.0667"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M102.30468 4.644529C101.74999 2.347659 100.51953 1.261718 99.277338 .816406C100.51953 .367187 101.74999-.718751 102.30468-3.015621"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M43.1797 14.9883H155.3707"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M45.61329 18.82029C45.0586 16.51951 43.82422 15.433574 42.582036 14.988262C43.82422 14.542949 45.0586 13.45701 45.61329 11.15623"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-41.8594 29.1602H183.7187"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-39.42965 32.99219C-39.98043 30.69532-41.2148 29.609378-42.45699 29.160159C-41.2148 28.714846-39.98043 27.62891-39.42965 25.33203"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-41.707032H240.4137 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-37.875C215.1411-40.17188 213.90672-41.257813 212.664534-41.707032C213.90672-42.152344 215.1411-43.23828 215.69188-45.53516"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M183.7187-27.5313H267.5627 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-31.36327C265.68782-29.06249 266.91829-27.980459 268.160474-27.53124C266.91829-27.085928 265.68782-25.99999 265.13313-23.69921"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M127.0237-55.8789V43.3359 fill=none stroke=#000 stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 188.4753 -20.6023)"><use x=-71.402255 xlink:href=#g0-103 y=-41.705315 /><use x=-64.695407 xlink:href=#g0-97 y=-41.705315 /><use x=-58.203748 xlink:href=#g0-112 y=-41.705315 /></g></g><title>A couple of "chained" forward arrows, with the last one's head pointing to a vertical "gap" marker. A couple of backward arrows cross this marker. There are also a few random arrows to the right of the gap.</title></svg></div><div class="diagram only-dark"><svg viewbox="-72.000111 -68.679719 340.75835 112.613384"height=112.613384pt version=1.1 width=340.75835pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M.561893-3.21594C.561893-2.187796 .789041-1.374844 1.243337-.777086S2.295392 .119552 3.036613 .119552S4.375592-.131507 4.805978-.633624V-.083686C4.805978 .454296 4.65056 .872727 4.363636 1.159651C4.076712 1.458531 3.670237 1.601993 3.144209 1.601993C2.47472 1.601993 1.900872 1.315068 1.446575 .74122L.884682 1.398755C1.111831 1.733499 1.446575 2.008468 1.876961 2.199751S2.761644 2.486675 3.21594 2.486675C4.028892 2.486675 4.686426 2.259527 5.164633 1.78132C5.642839 1.315068 5.893898 .669489 5.893898-.155417V-6.312329H4.913574L4.853798-5.618929C4.423412-6.156912 3.813699-6.43188 3.048568-6.43188C2.295392-6.43188 1.697634-6.133001 1.243337-5.559153S.561893-4.196264 .561893-3.21594ZM1.649813-3.084433C1.649813-3.88543 1.793275-4.495143 2.092154-4.901619C2.379078-5.308095 2.797509-5.511333 3.323537-5.511333C3.969116-5.511333 4.471233-5.212453 4.805978-4.614695V-1.733499C4.483188-1.111831 3.981071-.800996 3.311582-.800996C2.785554-.800996 2.367123-1.004234 2.080199-1.41071S1.649813-2.367123 1.649813-3.084433Z"id=g0-103 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /></defs><g id=page1><path d=M-71.402346-41.707032H12.4414 fill=none stroke=#e64d80 stroke-width=1.19553 /><path d="M10.01176-45.53516C10.56645-43.23828 11.79692-42.152344 13.039103-41.707032C11.79692-41.257813 10.56645-40.17188 10.01176-37.875"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-27.5313H69.1367 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-31.36327C67.25782-29.06249 68.49219-27.980459 69.734381-27.53124C68.49219-27.085928 67.25782-25.99999 66.70704-23.69921"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-13.3594H125.8277 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-17.1875C123.95351-14.89063 125.18398-13.804688 126.426169-13.359375C125.18398-12.910157 123.95351-11.82813 123.39883-9.52734"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M99.8747 .8164H212.0667"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M102.30468 4.644529C101.74999 2.347659 100.51953 1.261718 99.277338 .816406C100.51953 .367187 101.74999-.718751 102.30468-3.015621"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M43.1797 14.9883H155.3707"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M45.61329 18.82029C45.0586 16.51951 43.82422 15.433574 42.582036 14.988262C43.82422 14.542949 45.0586 13.45701 45.61329 11.15623"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-41.8594 29.1602H183.7187"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-39.42965 32.99219C-39.98043 30.69532-41.2148 29.609378-42.45699 29.160159C-41.2148 28.714846-39.98043 27.62891-39.42965 25.33203"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-41.707032H240.4137 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-37.875C215.1411-40.17188 213.90672-41.257813 212.664534-41.707032C213.90672-42.152344 215.1411-43.23828 215.69188-45.53516"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M183.7187-27.5313H267.5627 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-31.36327C265.68782-29.06249 266.91829-27.980459 268.160474-27.53124C266.91829-27.085928 265.68782-25.99999 265.13313-23.69921"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M127.0237-55.8789V43.3359 fill=none stroke=#fff stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 188.4753 -20.6023)"fill=#fff><use x=-71.402255 xlink:href=#g0-103 y=-41.705315 /><use x=-64.695407 xlink:href=#g0-97 y=-41.705315 /><use x=-58.203748 xlink:href=#g0-112 y=-41.705315 /></g></g><title>A couple of "chained" forward arrows, with the last one's head pointing to a vertical "gap" marker. A couple of backward arrows cross this marker. There are also a few random arrows to the right of the gap.</title></svg></div><p>Create new dispatch arrows from <eq><math><mi>l</mi></math></eq> to the backward arrows’ heads – they will all be to the left of the gap – and satisfy the backward arrows with an assignment to the selector and a <code>continue</code>. This makes the gap valid and recursion possible:<div class="diagram only-light"><svg viewbox="-72.000111 -68.679719 340.75835 112.613384"height=112.613384pt version=1.1 width=340.75835pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M.561893-3.21594C.561893-2.187796 .789041-1.374844 1.243337-.777086S2.295392 .119552 3.036613 .119552S4.375592-.131507 4.805978-.633624V-.083686C4.805978 .454296 4.65056 .872727 4.363636 1.159651C4.076712 1.458531 3.670237 1.601993 3.144209 1.601993C2.47472 1.601993 1.900872 1.315068 1.446575 .74122L.884682 1.398755C1.111831 1.733499 1.446575 2.008468 1.876961 2.199751S2.761644 2.486675 3.21594 2.486675C4.028892 2.486675 4.686426 2.259527 5.164633 1.78132C5.642839 1.315068 5.893898 .669489 5.893898-.155417V-6.312329H4.913574L4.853798-5.618929C4.423412-6.156912 3.813699-6.43188 3.048568-6.43188C2.295392-6.43188 1.697634-6.133001 1.243337-5.559153S.561893-4.196264 .561893-3.21594ZM1.649813-3.084433C1.649813-3.88543 1.793275-4.495143 2.092154-4.901619C2.379078-5.308095 2.797509-5.511333 3.323537-5.511333C3.969116-5.511333 4.471233-5.212453 4.805978-4.614695V-1.733499C4.483188-1.111831 3.981071-.800996 3.311582-.800996C2.785554-.800996 2.367123-1.004234 2.080199-1.41071S1.649813-2.367123 1.649813-3.084433Z"id=g0-103 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /></defs><g id=page1><path d=M-71.402346-41.707032H12.4414 fill=none stroke=#f33 stroke-width=1.19553 /><path d="M10.01176-45.53516C10.56645-43.23828 11.79692-42.152344 13.039103-41.707032C11.79692-41.257813 10.56645-40.17188 10.01176-37.875"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-27.5313H69.1367 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-31.36327C67.25782-29.06249 68.49219-27.980459 69.734381-27.53124C68.49219-27.085928 67.25782-25.99999 66.70704-23.69921"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-13.3594H125.8277 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-17.1875C123.95351-14.89063 125.18398-13.804688 126.426169-13.359375C125.18398-12.910157 123.95351-11.82813 123.39883-9.52734"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 .8164H97.4847"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M95.05079-3.015621C95.60547-.718751 96.83985 .367187 98.082036 .816406C96.83985 1.261718 95.60547 2.347659 95.05079 4.644529"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 14.9883H40.7887"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M38.35941 11.15623C38.91019 13.45701 40.14456 14.542949 41.38675 14.988262C40.14456 15.433574 38.91019 16.51951 38.35941 18.82029"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 29.1602H-44.25"fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-46.68363 25.33203C-46.12895 27.62891-44.89457 28.714846-43.652384 29.160159C-44.89457 29.609378-46.12895 30.69532-46.68363 32.99219"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-41.707032H240.4137 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-37.875C215.1411-40.17188 213.90672-41.257813 212.664534-41.707032C213.90672-42.152344 215.1411-43.23828 215.69188-45.53516"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M183.7187-27.5313H267.5627 fill=none stroke=#f33 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-31.36327C265.68782-29.06249 266.91829-27.980459 268.160474-27.53124C266.91829-27.085928 265.68782-25.99999 265.13313-23.69921"fill=none stroke=#f33 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M127.0237-55.8789V43.3359 fill=none stroke=#000 stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 188.4753 -20.6023)"><use x=-71.402255 xlink:href=#g0-103 y=-41.705315 /><use x=-64.695407 xlink:href=#g0-97 y=-41.705315 /><use x=-58.203748 xlink:href=#g0-112 y=-41.705315 /></g></g><title>All backward arrows have been replaced with forward arrows, starting at the very left and ending at the same position as before.</title></svg></div><div class="diagram only-dark"><svg viewbox="-72.000111 -68.679719 340.75835 112.613384"height=112.613384pt version=1.1 width=340.75835pt xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M4.722291 0H5.846077V-.095641C5.702615-.430386 5.630884-.896638 5.630884-1.482441V-4.387547C5.606974-5.021171 5.391781-5.523288 4.985305-5.881943C4.566874-6.240598 3.993026-6.43188 3.275716-6.43188C2.809465-6.43188 2.391034-6.336239 2.008468-6.168867S1.315068-5.762391 1.099875-5.475467C.872727-5.188543 .765131-4.877709 .765131-4.566874H1.853051C1.853051-4.841843 1.984558-5.080946 2.247572-5.272229S2.833375-5.559153 3.21594-5.559153C3.646326-5.559153 3.981071-5.439601 4.208219-5.224408C4.423412-4.99726 4.542964-4.698381 4.542964-4.327771V-3.825654H3.490909C2.582316-3.825654 1.888917-3.634371 1.3868-3.275716S.633624-2.402989 .633624-1.745455C.633624-1.207472 .824907-.765131 1.231382-.406476C1.625903-.047821 2.139975 .119552 2.761644 .119552C3.455044 .119552 4.064757-.143462 4.566874-.669489C4.60274-.3467 4.65056-.119552 4.722291 0ZM2.929016-.824907C2.570361-.824907 2.283437-.920548 2.056289-1.111831S1.721544-1.566127 1.721544-1.900872C1.721544-2.666002 2.379078-3.060523 3.706102-3.060523H4.542964V-1.769365C4.399502-1.482441 4.184309-1.255293 3.88543-1.08792C3.574595-.908593 3.263761-.824907 2.929016-.824907Z"id=g0-97 /><path d="M.561893-3.21594C.561893-2.187796 .789041-1.374844 1.243337-.777086S2.295392 .119552 3.036613 .119552S4.375592-.131507 4.805978-.633624V-.083686C4.805978 .454296 4.65056 .872727 4.363636 1.159651C4.076712 1.458531 3.670237 1.601993 3.144209 1.601993C2.47472 1.601993 1.900872 1.315068 1.446575 .74122L.884682 1.398755C1.111831 1.733499 1.446575 2.008468 1.876961 2.199751S2.761644 2.486675 3.21594 2.486675C4.028892 2.486675 4.686426 2.259527 5.164633 1.78132C5.642839 1.315068 5.893898 .669489 5.893898-.155417V-6.312329H4.913574L4.853798-5.618929C4.423412-6.156912 3.813699-6.43188 3.048568-6.43188C2.295392-6.43188 1.697634-6.133001 1.243337-5.559153S.561893-4.196264 .561893-3.21594ZM1.649813-3.084433C1.649813-3.88543 1.793275-4.495143 2.092154-4.901619C2.379078-5.308095 2.797509-5.511333 3.323537-5.511333C3.969116-5.511333 4.471233-5.212453 4.805978-4.614695V-1.733499C4.483188-1.111831 3.981071-.800996 3.311582-.800996C2.785554-.800996 2.367123-1.004234 2.080199-1.41071S1.649813-2.367123 1.649813-3.084433Z"id=g0-103 /><path d="M6.156912-3.084433V-3.19203C6.156912-4.208219 5.929763-4.99726 5.487422-5.571108S4.447323-6.43188 3.694147-6.43188C2.905106-6.43188 2.283437-6.156912 1.853051-5.618929L1.80523-6.312329H.812951V2.426899H1.900872V-.609714C2.331258-.119552 2.940971 .119552 3.706102 .119552C4.447323 .119552 5.045081-.167372 5.487422-.753176S6.156912-2.116065 6.156912-3.084433ZM5.068991-3.21594C5.068991-2.402989 4.913574-1.78132 4.614695-1.374844C4.303861-.968369 3.897385-.765131 3.383313-.765131C2.713823-.765131 2.223661-1.052055 1.900872-1.625903V-4.65056C2.223661-5.224408 2.713823-5.511333 3.371357-5.511333C3.897385-5.511333 4.303861-5.296139 4.614695-4.889664C4.913574-4.483188 5.068991-3.921295 5.068991-3.21594Z"id=g0-112 /></defs><g id=page1><path d=M-71.402346-41.707032H12.4414 fill=none stroke=#e64d80 stroke-width=1.19553 /><path d="M10.01176-45.53516C10.56645-43.23828 11.79692-42.152344 13.039103-41.707032C11.79692-41.257813 10.56645-40.17188 10.01176-37.875"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-width=1.19553 /><path d=M-14.707-27.5313H69.1367 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M66.70704-31.36327C67.25782-29.06249 68.49219-27.980459 69.734381-27.53124C68.49219-27.085928 67.25782-25.99999 66.70704-23.69921"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M41.9847-13.3594H125.8277 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M123.39883-17.1875C123.95351-14.89063 125.18398-13.804688 126.426169-13.359375C125.18398-12.910157 123.95351-11.82813 123.39883-9.52734"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 .8164H97.4847"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M95.05079-3.015621C95.60547-.718751 96.83985 .367187 98.082036 .816406C96.83985 1.261718 95.60547 2.347659 95.05079 4.644529"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 14.9883H40.7887"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M38.35941 11.15623C38.91019 13.45701 40.14456 14.542949 41.38675 14.988262C40.14456 15.433574 38.91019 16.51951 38.35941 18.82029"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-71.402346 29.1602H-44.25"fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M-46.68363 25.33203C-46.12895 27.62891-44.89457 28.714846-43.652384 29.160159C-44.89457 29.609378-46.12895 30.69532-46.68363 32.99219"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M213.2617-41.707032H240.4137 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M215.69188-37.875C215.1411-40.17188 213.90672-41.257813 212.664534-41.707032C213.90672-42.152344 215.1411-43.23828 215.69188-45.53516"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M183.7187-27.5313H267.5627 fill=none stroke=#e64d80 stroke-miterlimit=10 stroke-width=1.19553 /><path d="M265.13313-31.36327C265.68782-29.06249 266.91829-27.980459 268.160474-27.53124C266.91829-27.085928 265.68782-25.99999 265.13313-23.69921"fill=none stroke=#e64d80 stroke-linecap=round stroke-linejoin=round stroke-miterlimit=10 stroke-width=1.19553 /><path d=M127.0237-55.8789V43.3359 fill=none stroke=#fff stroke-miterlimit=10 stroke-width=1.19553 /><g transform="matrix(1 0 0 1 188.4753 -20.6023)"fill=#fff><use x=-71.402255 xlink:href=#g0-103 y=-41.705315 /><use x=-64.695407 xlink:href=#g0-97 y=-41.705315 /><use x=-58.203748 xlink:href=#g0-112 y=-41.705315 /></g></g><title>All backward arrows have been replaced with forward arrows, starting at the very left and ending at the same position as before.</title></svg></div><p>To reiterate, dispatchers are only necessary as a fallback for complicated control flow. javac does not (typically) generate such code, and handling this case is mostly only required for correctness and completeness, as JVM bytecode doesn’t forbid it.<p class=next-group><span aria-level=3 class=side-header role=heading><span>In a nutshell</span></span>Phew. Here’s a bird’s eye view of what we’ve done.<ol><li><p>Given a range <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> and an arrow set, we searched for gaps in <eq><math><mrow><mo form=prefix stretchy=false>(</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>)</mo></mrow></math></eq> that weren’t covered by the arrows. We split <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> at such gaps and recursed.</p><li><p>We then created a block for <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq>, marked all backward arrows to <eq><math><mi>l</mi></math></eq> and forward arrows to <eq><math><mi>r</mi></math></eq> as satisfied, and removed them from the arrow set. (We don’t necessarily have to check if they start within the range, as all arrows covering the range have already been resolved; but we do have to only filter for <em>backward</em> arrows to <eq><math><mi>l</mi></math></eq> and <em>forward</em> arrow to <eq><math><mi>r</mi></math></eq>, because there can be arrows pointing in the other direction from outside the range.)</p><li><p>We then found the leftmost split gap taking only forward arrows into account, found all backward arrows crossing this gap (again, such arrows are necessarily within the block; there can also be no such arrows, and that’s fine too), marked them as satisfied with a jump to dispatch, and removed them from the arrow set. We added forward dispatch arrows to the arrow set. After that, we recursed, as we know there’s now a valid split gap.</p></ol><p>A key property of the resulting AST is that each block has at least one arrow that couldn’t be satisfied by any other block, making it minimal in a certain sense. Each jump is satisfied by the outermost valid block, not the innermost, as your passes might expect, but this is a <em>good</em> thing. As javac threads <code>goto</code>s, javac can easily implement a <code>break</code> from an internal loop as a <code>continue</code> of an outer loop, and the nested <code>if</code> example from the beginning of the post still applies, so forcing the outermost block as the target reduces the number of cases that must be handled.<p>The blocks are also minimal in the sense that either the first statement of the block uses <code>break</code> or someone inside the block uses <code>continue</code>, and that either the last statement uses <code>continue</code> or someone inside the loop uses <code>break</code>. This means that, among other things, a block without <code>continue</code> will necessarily <em>start</em> with an <code>if (...) break;</code>, indicating that this block can be implemented with an <code>if</code>; and vice versa, an <code>if</code> can only be parsed as a block <em>starting</em> with <code>if (...) break;</code>, not merely <em>containing</em> such a statement somewhere in the middle. This makes patterns easy to enumerate.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Implementation</span></span>At the beginning of the post, I mentioned that CFG-style approaches are not only sometimes bad at code generation but also slow, so it’s time to explain how to improve time complexity of this approach.<p>First, we introduce a data structure over arrows that supports the following queries in logarithmic time:<ul><li>Add arrow <eq><math><mrow><mi>x</mi><mo>→</mo></mrow><mrow><mi>y</mi></mrow></math></eq>.<li>Remove arrow <eq><math><mrow><mi>x</mi><mo>→</mo></mrow><mrow><mi>y</mi></mrow></math></eq>.<li>Find the first split gap in range <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq>.</ul><p>It’s quite simple – a <a href=https://cp-algorithms.com/data_structures/segment_tree.html>segment tree</a> (the one supporting range queries, not from computational geometry) over gaps suffices:<ul><li>Adding an arrow can be implemented by incrementing the counters corresponding to all gaps in a certain range (specifically, <eq><math><mrow><mo form=prefix stretchy=false>(</mo><mrow><mi>min</mi><mo>⁡</mo></mrow><mo form=prefix stretchy=false>(</mo><mi>x</mi><mo separator=true>,</mo><mi>y</mi><mo form=postfix stretchy=false>)</mo><mo separator=true>,</mo><mrow><mi>max</mi><mo>⁡</mo></mrow><mo form=prefix stretchy=false>(</mo><mi>x</mi><mo separator=true>,</mo><mi>y</mi><mo form=postfix stretchy=false>)</mo><mo form=postfix stretchy=false>)</mo></mrow></math></eq>), marking them as blocked from splitting by the arrow.<li>Removing an arrow can be implemented by decrementing the counters over the same range.<li>Finding a split gap amounts to finding the first <eq><math><mn>0</mn></math></eq> in the range, which can be implemented by storing the minimum and its position and verifying that the minimum is <eq><math><mn>0</mn></math></eq>.</ul><p>This can be used to split the <eq><math><mrow><mo form=prefix stretchy=false>[</mo><mi>l</mi><mo separator=true>;</mo><mi>r</mi><mo form=postfix stretchy=false>]</mo></mrow></math></eq> range by gaps and to find the first split gap over forward arrows only.<p>The search for backward arrows crossing a given gap can be straightforwardly implemented with an <a href=https://en.wikipedia.org/wiki/Interval_tree>interval tree</a>.<p>Finally, simple arrays can be used to find forward and backward arrows ending at a certain point.<p class=next-group><span aria-level=3 class=side-header role=heading><span>Conclusion</span></span>So. That’s how you implement a high-quality control flow restoration algorithm with quasilinear performance. Q&A:<p><strong>Why does decompilation performance matter this much to you?</strong><p>Because I have a use case that requires a fast and slim Java decompiler, and so I started doing some research, and suddenly three weeks have already passed, and this is where I found myself.<p><strong>Why no realistic samples?</strong><p>Because you need a ton of passes <em>after</em> control flow structuring to make the code somewhat readable. This is just one part of the process, and while its implementation is interesting from a technical point of view, the results themselves are boring. I’ll draw the rest of the fucking owl someday, but it’s harder than it seems.<p><strong>Why not wait until you get further results?</strong><p>Because I might stumble upon some other problem I don’t know how to resolve and not finish the project. This is my way of sharing knowledge while I still can.<p><strong>If I understand the above, can I make a Java decompiler?</strong><p>Maybe, but don’t hold your breath. This is just the beginning – you still need to write passes to convert blocks to <code>if</code>s and <code>while</code>s, you need to handle complicated control flow with <code>&&</code> and <code>||</code> in <code>if</code>/<code>while</code> conditions, you need to handle exception handlers and <code>synchronized</code> monitors, and so on. Decompiling Java is <em>not</em> simple at all unless you don’t care about correctness, efficiency, and code quality, which… many decompilers don’t, and that’s valid, but it’s not something I’d be proud of.<p><strong>Can this be applied to other languages?</strong><p>If we’re talking about bytecode-based languages, then yes, the core of the work should be applicable as is. For native code, it’s probably not that easy, as the compiler often reorders code for efficiency. This is somewhat a problem for obfuscated JVM bytecode as well – it’s just out of scope for me at the moment – but you’ll likely get acceptable results if you reorder statements according to DFS order and a few heuristics. No guarantees, though.</div></section><footer><div class=viewport-container><h2>Made with my own bare hands (why.)</h2></div></footer><script>window.addEventListener("keydown", e => {
				if (e.key === "Enter") {
					if (e.ctrlKey) {
						window.open("https://github.com/purplesyringa/site/edit/master/blog/recovering-control-flow-structures-without-cfgs/index.md", "_blank");
					} else if (
						e.target.type === "checkbox"
						&& e.target.parentNode
						&& e.target.parentNode.className === "expansible-code"
					) {
						e.target.click();
					}
				}
			});</script>